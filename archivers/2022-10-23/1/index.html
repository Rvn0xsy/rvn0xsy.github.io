<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>使用RPC Filter技术防御内网RPC横向攻击 - 倾旋的博客</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css media=screen href=https://payloads.online/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://payloads.online/css/main.css><link rel=stylesheet type=text/css media=screen href=https://payloads.online/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://payloads.online/css/dark.css><script src=https://payloads.online/js/feather.min.js></script><script src=https://payloads.online/js/main.js></script><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Inter:wght@400;500;600;700&display=swap"><link rel=stylesheet href=/css/fontawesome.css></head><body><div class="container-wide wrapper"><div class=header><div class=avatar><a href=https://payloads.online/><img src=/avatar.jpeg alt=倾旋的博客></a></div><h1 class=site-title><a href=https://payloads.online/>倾旋的博客</a></h1><div class=site-description><p>现阶段在进行有效性验证/攻击模拟相关的安全研究工作，我的博客会记录一些我的学习过程和部分安全技术研究成果。</p><nav class="nav social"><ul class=flat><li><a href=https://github.com/rvn0xsy/ title=Github><i data-feather=github></i></a></li><li><a href=/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>首页</a></li><li><a href=/posts/>文章列表</a></li><li><a href=/tags>标签</a></li><li><a href=/projects>开源项目</a></li><li><a href=/about>关于我</a></li><li><a href=/links/>友情链接</a></li><li><a href=/message>留言</a></li><li><a href=/sponsor>赞助</a></li></ul></nav></div><div class=article-nav id=article-nav-id><div class=post><div class=post-header><div class=meta><div class=date><span class=day>23</span>
<span class=rest>Oct 2022</span></div></div><div class=matter><h1 class=title>使用RPC Filter技术防御内网RPC横向攻击</h1></div></div><aside class="show-on-mobile toc" id=static-toc><header><h3>Contents</h3></header><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#什么是wfp>什么是WFP？</a><ol><li><a href=#rpc-filer>RPC Filer</a></li><li><a href=#使用netsh命令添加rpc-filer规则阻断impacket-atexec>使用Netsh命令添加RPC Filer规则阻断Impacket atexec</a></li></ol></li><li><a href=#拦截dcom-ioxidresolver接口网卡探测>拦截DCOM IOXIDResolver接口网卡探测</a></li><li><a href=#批量添加rpc-filter规则>批量添加RPC Filter规则</a></li><li><a href=#防御petitpotam漏洞>防御<strong><strong>PetitPotam漏洞</strong></strong></a></li><li><a href=#总结>总结</a></li><li><a href=#参考>参考</a></li></ol></nav></aside><h2 id=前言>前言</h2><p><a href=https://github.com/SecureAuthCorp/impacket>Impacket</a>工具包中所包含的内网横向技术大多都是依赖于RPC协议的，但对于RPC协议的攻击防御除了网络流量侧的检测识别以外，还可以通过Windows 内置的<a href=https://learn.microsoft.com/en-au/windows/win32/fwp/what-s-new-in-windows-filtering-platform>WFP</a>(Windows Filtering Platform)技术。</p><p>这里提一下，流量测如何分析并防御impacket内网横向：<a href=https://riccardoancarani.github.io/2020-05-10-hunting-for-impacket/#wmiexecpy>https://riccardoancarani.github.io/2020-05-10-hunting-for-impacket/</a></p><p>关于RPC的攻击技术及漏洞整理了以下部分，使用RPC Filter可以达到阻断漏洞被利用和攻击的效果：</p><ul><li>impacket-atexec 通过SMB协议认证，利用<a href=https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931>MS-TSCH</a> RPC协议服务注册任务计划进行横向移动。</li><li>impacket-psexec 通过SMB协议认证，利用<a href=https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-scmr/705b624a-13de-43cc-b8a2-99573da3635f>MS-SCMR</a> RPC协议注册系统服务进行横向移动。</li><li>impacket-dcomexec 通过SMB认证，利用<a href=https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-dcom/4a893f3d-bd29-48cd-9f43-d9777a4415b0>MS-DCOM</a> RPC协议调用COM组件执行横向移动。</li><li>impacket-wmiexec 通过SMB认证，利用<a href=https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-dcom/4a893f3d-bd29-48cd-9f43-d9777a4415b0>MS-DCOM</a> RPC协议调用COM组件执行横向移动。</li><li>大名鼎鼎的<a href=https://github.com/topotam/PetitPotam>PetitPotam</a> <a href=https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36942>CVE-2021-36942</a> 利用<a href=https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-efsr/08796ba8-01c8-4872-9221-1000ec2eff31>MS-EFSRPC</a>协议让服务器访问攻击者构造的地址进行NTLM重定向攻击。</li><li>PrintNightmare Windows Print Spooler权限提升漏洞（CVE-2021-1675），利用MS-RPRN进行提权，其原理也是通过调用RPC接口，让服务器访问特定的路径。</li><li>除了这类漏洞的利用，还有大部分的土豆提全系列都有使用到RPC接口，让系统SYSTEM特权进程访问攻击者构造的管道，然后进行令牌模拟，达到窃取Token然后提权的目的。</li></ul><h2 id=什么是wfp>什么是WFP？</h2><blockquote><p>Windows Filtering Platform (WFP) is a network traffic processing platform designed to replace the Windows XP and Windows Server 2003 network traffic filtering interfaces. WFP consists of a set of hooks into the network stack and a filtering engine that coordinates network stack interactions.</p></blockquote><p>顾名思义，他是一个网络流量处理平台，用于替代Windows Server 2003、Windows XP平台下的网络流量过滤接口。WFP 由一组进入网络堆栈的钩子和一个协调网络堆栈交互的过滤引擎组成。</p><p>随便查看WFP的<a href=https://learn.microsoft.com/en-us/windows/win32/api/fwpmu/nf-fwpmu-fwpmfilteradd0>API</a>，可以大致确定这个技术的支持版本，大部分API还是兼容性较强的，也就是说这个技术在Windows很早就有了：</p><p><img src=https://images.payloads.online/2022-10-23-22-51-22.png alt></p><h3 id=rpc-filer>RPC Filer</h3><p>而RPC Filter他是一种基于RPC协议的一种过滤技术，可以通过多个维度进行过滤，本文仅仅展开基于UUID来过滤对应的RPC协议。RPC Filter属于在WFP技术中的一部分。通过设置FWPM_FILTER0和FWPM_FILTER_CONDITION0结构可以配置Filter规则，然后调用相对应的API就能够完成Filter的注册。</p><h3 id=使用netsh命令添加rpc-filer规则阻断impacket-atexec>使用Netsh命令添加RPC Filer规则阻断Impacket atexec</h3><p>除了API接口以外，我们还可以通过系统自带的netsh命令来直接设置Filter规则，例如这里我直接设置一个不允许<a href=https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931>MS-TSCH</a> 远程调用的例子：</p><p>环境：</p><ul><li>被攻击者 Windows Server 2008 IP: 192.168.31.134</li><li>攻击者 Linux</li></ul><p>首先使用atexec.py正常攻击一次：</p><p><img src=https://images.payloads.online/2022-10-23-22-51-41.png alt></p><p>这里可以看到可以攻击成功，RPC SchRpcRegisterTask 成功，这个API其实就是之前实现的<a href=https://github.com/Rvn0xsy/SchtaskCreator>远程创建任务计划工具</a>，原理没有任何区别。</p><p>在Windows Server 2008上开始操作netsh，添加Filter：</p><p><img src=https://images.payloads.online/2022-10-23-22-51-55.png alt></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>rpc
</span></span><span style=display:flex><span>filter
</span></span><span style=display:flex><span>add rule layer=um actiontype=block
</span></span><span style=display:flex><span>add condition field=if_uuid matchtype=equal data=86D35949-83C9-4044-B424-DB363231FD0C
</span></span><span style=display:flex><span>add filter
</span></span></code></pre></td></tr></table></div></div><p>86D35949-83C9-4044-B424-DB363231FD0C 这个UUID代表了ITaskSchedulerService，在数据包中我们可以看到：</p><p><img src=https://images.payloads.online/2022-10-23-22-52-16.png alt></p><p>添加完Filter以后，我们这个时候再进行一次横向测试：</p><p><img src=https://images.payloads.online/2022-10-23-22-52-29.png alt></p><p>可以看到，已经无法注册任务计划了，atexec执行失败，而且RPC Filter其实和防火墙没有直接的关系，在测试期间Windows Server 2008的防火墙是关闭的状态。</p><p><img src=https://images.payloads.online/2022-10-23-22-52-43.png alt></p><p>除了计划任务以外还有很多，这里罗列一下：</p><ul><li><code>1FF70682-0A51-30E8-076D-740BE8CEE98B</code>  <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931>Schedueled Task (MS-TSCH)</a> ATSvc</li><li><code>378E52B0-C0A9-11CF-822D-00AA0051E40F</code>  <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931>Schedueled Task (MS-TSCH)</a> SASec</li><li><code>86D35949-83C9-4044-B424-DB363231FD0C</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931>Schedueled Task (MS-TSCH)</a> ITaskSchedulerService</li><li><code>4FC742E0-4A10-11CF-8273-00AA004AE673</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-dfsnm/a7ecdbe0-c138-471d-85b6-a474825da9eb>Distributed File System (DFS): Namespace Management Protocol</a> MS-DFSNM</li><li><code>e3514235-4b06-11d1-ab04-00c04fc2dcd2</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-drsr/06205d97-30da-4fdc-a276-3fd831b272e0>Directory Replication Service (MS-DRSR)</a></li><li><code>a8e0653c-2744-4389-a61d-7373df8b2292</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-fsrvp/67f0fdd9-d8bc-445d-95de-2cb6d5c4d149>File Server Remote VSS Protocol - MS-FSRVP</a></li><li><code>c681d488-d850-11d0-8c52-00c04fd90f7e</code>  <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-efsr/08796ba8-01c8-4872-9221-1000ec2eff31>Encrypting File System Remote (EFSRPC) Protocol - (MS-EFSR)</a> (unauthenticated implementation)</li><li><code>df1941c5-fe89-4e79-bf10-463657acf44d</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-efsr/08796ba8-01c8-4872-9221-1000ec2eff31>Encrypting File System Remote (EFSRPC) Protocol - (MS-EFSR)</a></li><li><code>12345778-1234-ABCD-EF00-0123456789AB</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-lsad/1b5471ef-4c33-4a91-b079-dfcbb82f05cc>Local Security Authority (Domain Policy) Remote Protocol (MS-LSAD)</a> / <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-lsat/1ba21e6f-d8a9-462c-9153-4375f2020894>Local Security Authority (Translation Methods) Remote Protocol (MS-LSAT)</a></li><li><code>12345678-1234-ABCD-EF00-01234567CFFB</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-nrpc/ff8f970f-3e37-40f7-bd4b-af7336e4792f>Netlogon Remote Protocol - (NRPC)</a></li><li><code>12345678-1234-ABCD-EF00-0123456789AB</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/d42db7d5-f141-4466-8f47-0a4be14e2fc1>Print System Remote Protocol (MS-RPRN)</a></li><li><code>76F03F96-CDFD-44FC-A22C-64950A001209</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-par/695e3f9a-f83f-479a-82d9-ba260497c2d0>Print System Asynchronous Remote Protocol (MS-PAR)</a></li><li><code>338CD001-2244-31F1-AAAA-900038001003</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rrp/0fa3191d-bb79-490a-81bd-54c2601b7a78>Remote Registry (MS-RRP)</a></li><li><code>12345778-1234-ABCD-EF00-0123456789AC</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-samr/4df07fab-1bbc-452f-8e92-7853a3c7e380>Security Account Manager (SAM) Remote Protocol (MS-SAMR)</a></li><li><code>367ABB81-9844-35F1-AD32-98F038001003</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-scmr/705b624a-13de-43cc-b8a2-99573da3635f>Service Control Manager Remote Protocol (MS-SCMR)</a></li><li><code>4b324fc8-1670-01d3-1278-5a47bf6ee188</code> <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/accf23b0-0f57-441c-9185-43041f1b0ee9>Server Service Remote Protocol (MS-SRVS)</a></li><li><code>6BFFD098-A112-3610-9833-46C3F87E345A</code>**** <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-wkst/5bb08058-bc36-4d3c-abeb-b132228281b7>Workstation Service Remote Protocol (MS-WKST)</a></li><li>…..</li></ul><h2 id=拦截dcom-ioxidresolver接口网卡探测>拦截DCOM IOXIDResolver接口网卡探测</h2><p>之前有写过一篇 <a href=https://payloads.online/archivers/2020-07-16/1/>《通过OXID解析器获取Windows远程主机上网卡地址》</a> ，后来国内红队大部分扫描器就都开始集成这个功能，可以在未授权的情况下访问Windows操作系统的135端口获取网卡上的IP地址，主要是利用了IOXIDResolver 这个接口，通过抓包分析：</p><p><img src=https://images.payloads.online/2022-10-23-22-53-10.png alt></p><p>IOXIDResolver 对应的UUID是 99fcfec4-5260-101b-bbcb-00aa0021347a ，因此我们也同样可以使用netsh将这个协议给拦截掉。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>add rule layer=um actiontype=block
</span></span><span style=display:flex><span>add condition field=if_uuid matchtype=equal data=99fcfec4-5260-101b-bbcb-00aa0021347a
</span></span><span style=display:flex><span>add filter
</span></span></code></pre></td></tr></table></div></div><p>添加RPC Filter之前：</p><p><img src=https://images.payloads.online/2022-10-23-22-53-28.png alt></p><p>添加RPC Filter之后：</p><p><img src=https://images.payloads.online/2022-10-23-22-53-38.png alt></p><h2 id=批量添加rpc-filter规则>批量添加RPC Filter规则</h2><p>netsh命令支持以文件作为命令输入，例如：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>netsh -f &lt;command file&gt;
</span></span></code></pre></td></tr></table></div></div><p>我们可以将多条指令存放到文件中，执行命令加载：</p><p><img src=https://images.payloads.online/2022-10-23-22-53-53.png alt></p><h2 id=防御petitpotam漏洞>防御<strong><strong>PetitPotam漏洞</strong></strong></h2><p><a href=https://twitter.com/gentilkiwi>Benjamin Delpy</a> 早在去年有提到可以通过RPC Filter阻断PetitPotam漏洞：</p><p><img src=https://images.payloads.online/2022-10-23-22-54-06.png alt></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>rpc
</span></span><span style=display:flex><span>filter
</span></span><span style=display:flex><span>add rule layer=um actiontype=block
</span></span><span style=display:flex><span>add condition field=if_uuid matchtype=equal data=c681d488-d850-11d0-8c52-00c04fd90f7e
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer=um actiontype=block
</span></span><span style=display:flex><span>add condition field=if_uuid matchtype=equal data=df1941c5-fe89-4e79-bf10-463657acf44d
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>quit
</span></span></code></pre></td></tr></table></div></div><p>这里索性整理一下全部的Filter规则：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>rpc
</span></span><span style=display:flex><span>filter
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用 MS-EFSR PetitPotam 提权 Encrypting File System Remote (EFSRPC) Protocol - (MS-EFSR)</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>c681d488<span style=color:#f92672>-</span>d850<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span>d0<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span>c52<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>c04fd90f7e
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>df1941c5<span style=color:#f92672>-</span>fe89<span style=color:#f92672>-</span><span style=color:#ae81ff>4e79</span><span style=color:#f92672>-</span>bf10<span style=color:#f92672>-</span><span style=color:#ae81ff>463657</span>acf44d
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用远程管理系统服务 Service Control Manager Remote Protocol (MS-SCMR) </span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>367</span>ABB81<span style=color:#f92672>-</span><span style=color:#ae81ff>9844</span><span style=color:#f92672>-</span><span style=color:#ae81ff>35</span>F1<span style=color:#f92672>-</span>AD32<span style=color:#f92672>-</span><span style=color:#ae81ff>98</span>F038001003
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;KA;;;DA)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>367</span>ABB81<span style=color:#f92672>-</span><span style=color:#ae81ff>9844</span><span style=color:#f92672>-</span><span style=color:#ae81ff>35</span>F1<span style=color:#f92672>-</span>AD32<span style=color:#f92672>-</span><span style=color:#ae81ff>98</span>F038001003
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用命名空间管理Distributed File System (DFS)</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>FC742E0<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>A10<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span>CF<span style=color:#f92672>-</span><span style=color:#ae81ff>8273</span><span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>AA004AE673
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>auth_type matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>auth_level matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>FC742E0<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>A10<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span>CF<span style=color:#f92672>-</span><span style=color:#ae81ff>8273</span><span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>AA004AE673
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用DCSync攻击 Directory Replication Service (MS-DRSR)</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>e3514235<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>b06<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span>d1<span style=color:#f92672>-</span>ab04<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>c04fc2dcd2
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;CC;;;DD)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>e3514235<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>b06<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span>d1<span style=color:#f92672>-</span>ab04<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>c04fc2dcd2
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用LLMNR/NBT-NS Poisoning and SMB Relay</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>a8e0653c<span style=color:#f92672>-</span><span style=color:#ae81ff>2744</span><span style=color:#f92672>-</span><span style=color:#ae81ff>4389</span><span style=color:#f92672>-</span>a61d<span style=color:#f92672>-</span><span style=color:#ae81ff>7373</span>df8b2292
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>auth_type matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>auth_level matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>a8e0653c<span style=color:#f92672>-</span><span style=color:#ae81ff>2744</span><span style=color:#f92672>-</span><span style=color:#ae81ff>4389</span><span style=color:#f92672>-</span>a61d<span style=color:#f92672>-</span><span style=color:#ae81ff>7373</span>df8b2292
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用远程枚举用户、添加用户 MS-LSAD &amp; MS-LSAT. MS-LSAT</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>12345778</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1234</span><span style=color:#f92672>-</span>ABCD<span style=color:#f92672>-</span>EF00<span style=color:#f92672>-</span><span style=color:#ae81ff>0123456789</span>AB
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;CC;;;BA)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>12345778</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1234</span><span style=color:#f92672>-</span>ABCD<span style=color:#f92672>-</span>EF00<span style=color:#f92672>-</span><span style=color:#ae81ff>0123456789</span>AB
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用ZeroLogon漏洞Netlogon Remote Protocol - (NRPC)</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>12345678</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1234</span><span style=color:#f92672>-</span>abcd<span style=color:#f92672>-</span>ef00<span style=color:#f92672>-</span><span style=color:#ae81ff>01234567</span>cffb
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;CC;;;DC)
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;CC;;;AU)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>12345678</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1234</span><span style=color:#f92672>-</span>abcd<span style=color:#f92672>-</span>ef00<span style=color:#f92672>-</span><span style=color:#ae81ff>01234567</span>cffb
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用MS-RPRN &amp; MS-PAR https://payloads.online/archivers/2022-03-04/1/</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>12345678</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1234</span><span style=color:#f92672>-</span>ABCD<span style=color:#f92672>-</span>EF00<span style=color:#f92672>-</span><span style=color:#ae81ff>0123456789</span>AB
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;CC;;;DA)
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>auth_level matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>12345678</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1234</span><span style=color:#f92672>-</span>ABCD<span style=color:#f92672>-</span>EF00<span style=color:#f92672>-</span><span style=color:#ae81ff>0123456789</span>AB
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>76</span>F03F96<span style=color:#f92672>-</span>CDFD<span style=color:#f92672>-</span><span style=color:#ae81ff>44</span>FC<span style=color:#f92672>-</span>A22C<span style=color:#f92672>-</span><span style=color:#ae81ff>64950</span>A001209
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;CC;;;DA)
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>auth_level matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>76</span>F03F96<span style=color:#f92672>-</span>CDFD<span style=color:#f92672>-</span><span style=color:#ae81ff>44</span>FC<span style=color:#f92672>-</span>A22C<span style=color:#f92672>-</span><span style=color:#ae81ff>64950</span>A001209
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用远程管理注册表</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>338</span>CD001<span style=color:#f92672>-</span><span style=color:#ae81ff>2244</span><span style=color:#f92672>-</span><span style=color:#ae81ff>31</span>F1<span style=color:#f92672>-</span>AAAA<span style=color:#f92672>-</span><span style=color:#ae81ff>900038001003</span>
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;KA;;;DA)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>367</span>ABB81<span style=color:#f92672>-</span><span style=color:#ae81ff>9844</span><span style=color:#f92672>-</span><span style=color:#ae81ff>35</span>F1<span style=color:#f92672>-</span>AD32<span style=color:#f92672>-</span><span style=color:#ae81ff>98</span>F038001003
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用远程枚举域用户 Security Account Manager (SAM) Remote Protocol (MS-SAMR)</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>12345778</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1234</span><span style=color:#f92672>-</span>ABCD<span style=color:#f92672>-</span>EF00<span style=color:#f92672>-</span><span style=color:#ae81ff>0123456789</span>AC
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;RC;;;BA)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>e3514235<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>b06<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span>d1<span style=color:#f92672>-</span>ab04<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>c04fc2dcd2
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用远程枚举域用户 Security Account Manager (SAM) Remote Protocol (MS-SAMR)</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>12345778</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1234</span><span style=color:#f92672>-</span>ABCD<span style=color:#f92672>-</span>EF00<span style=color:#f92672>-</span><span style=color:#ae81ff>0123456789</span>AC
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;RC;;;BA)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>e3514235<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>b06<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span>d1<span style=color:#f92672>-</span>ab04<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>c04fc2dcd2
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用NetSessionEnum 会话枚举</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>b324fc8<span style=color:#f92672>-</span><span style=color:#ae81ff>1670</span><span style=color:#f92672>-</span><span style=color:#ae81ff>01</span>d3<span style=color:#f92672>-</span><span style=color:#ae81ff>1278</span><span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>a47bf6ee188
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;CC;;;BA)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>b324fc8<span style=color:#f92672>-</span><span style=color:#ae81ff>1670</span><span style=color:#f92672>-</span><span style=color:#ae81ff>01</span>d3<span style=color:#f92672>-</span><span style=color:#ae81ff>1278</span><span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>a47bf6ee188
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 禁用远程管理计划任务</span>
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>FF70682<span style=color:#f92672>-</span><span style=color:#ae81ff>0</span>A51<span style=color:#f92672>-</span><span style=color:#ae81ff>30E8</span><span style=color:#f92672>-</span><span style=color:#ae81ff>076</span>D<span style=color:#f92672>-</span><span style=color:#ae81ff>740</span>BE8CEE98B
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;CC;;;DA)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>FF70682<span style=color:#f92672>-</span><span style=color:#ae81ff>0</span>A51<span style=color:#f92672>-</span><span style=color:#ae81ff>30E8</span><span style=color:#f92672>-</span><span style=color:#ae81ff>076</span>D<span style=color:#f92672>-</span><span style=color:#ae81ff>740</span>BE8CEE98B
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>378E52</span>B0<span style=color:#f92672>-</span>C0A9<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span>CF<span style=color:#f92672>-</span><span style=color:#ae81ff>822</span>D<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>AA0051E40F
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;CC;;;DA)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>378E52</span>B0<span style=color:#f92672>-</span>C0A9<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span>CF<span style=color:#f92672>-</span><span style=color:#ae81ff>822</span>D<span style=color:#f92672>-</span><span style=color:#ae81ff>00</span>AA0051E40F
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>permit
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>86</span>D35949<span style=color:#f92672>-</span><span style=color:#ae81ff>83</span>C9<span style=color:#f92672>-</span><span style=color:#ae81ff>4044</span><span style=color:#f92672>-</span>B424<span style=color:#f92672>-</span>DB363231FD0C
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>remote_user_token matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span>D:(A;;CC;;;DA)
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>add rule layer<span style=color:#f92672>=</span>um actiontype<span style=color:#f92672>=</span>block
</span></span><span style=display:flex><span>add condition field<span style=color:#f92672>=</span>if_uuid matchtype<span style=color:#f92672>=</span>equal data<span style=color:#f92672>=</span><span style=color:#ae81ff>86</span>D35949<span style=color:#f92672>-</span><span style=color:#ae81ff>83</span>C9<span style=color:#f92672>-</span><span style=color:#ae81ff>4044</span><span style=color:#f92672>-</span>B424<span style=color:#f92672>-</span>DB363231FD0C
</span></span><span style=display:flex><span>add filter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>quit
</span></span></code></pre></td></tr></table></div></div><blockquote><p>”#“是netsh批量执行的注释符号，上面的所有Filter请自行测试。</p></blockquote><p>我们可以根据场景需要来设置对应的RPC Filter，这将有效的降低基于RPC协议接口的内网横向技术所带来的风险。</p><h2 id=总结>总结</h2><p>本文介绍了RPC Filter技术的概念与使用，并演示了如何通过RPC Filter阻断基于计划任务的横向攻击，并给出了大量RPC Filter的参考，能够有效的应对impacket所提供的内网横向技术的攻击，文末参考的链接是我在编写此文所查阅的资料，对我的帮助很大。其中，对于RPC Filter的设置本文并没有介绍太多，微软的文档资料也比较少，后面有空将会编写对应的自动化加固工具，例如：根据系统的某一个用户制订专属的RPC Filter、防御SERVICE提权到SYSTEM特权的问题解决方案，这些netsh命令可能并不具备此功能，但WFP API具备。如果文中有错误，希望读者能够通过留言指教。</p><h2 id=参考>参考</h2><ul><li><a href=https://github.com/akamai/akamai-security-research/tree/main/rpc-filters>https://github.com/akamai/akamai-security-research/tree/main/rpc-filters</a></li><li><a href=https://github.com/jsecurity101/MSRPC-to-ATTACK/>https://github.com/jsecurity101/MSRPC-to-ATTACK/</a></li><li><a href=https://www.tiraniddo.dev/2021/08/how-windows-firewall-rpc-filter-works.html>https://www.tiraniddo.dev/2021/08/how-windows-firewall-rpc-filter-works.html</a></li><li><a href=https://googleprojectzero.blogspot.com/2021/08/understanding-network-access-windows-app.html>https://googleprojectzero.blogspot.com/2021/08/understanding-network-access-windows-app.html</a></li><li><a href=https://crfilter.com/>https://crfilter.com/</a></li><li><a href=https://learn.microsoft.com/en-us/windows/win32/api/fwpmtypes/ns-fwpmtypes-fwpm_filter_condition0>https://learn.microsoft.com/en-us/windows/win32/api/fwpmtypes/ns-fwpmtypes-fwpm_filter_condition0</a></li></ul></div><nav class="hide-on-mobile section-nav"><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#什么是wfp>什么是WFP？</a><ol><li><a href=#rpc-filer>RPC Filer</a></li><li><a href=#使用netsh命令添加rpc-filer规则阻断impacket-atexec>使用Netsh命令添加RPC Filer规则阻断Impacket atexec</a></li></ol></li><li><a href=#拦截dcom-ioxidresolver接口网卡探测>拦截DCOM IOXIDResolver接口网卡探测</a></li><li><a href=#批量添加rpc-filter规则>批量添加RPC Filter规则</a></li><li><a href=#防御petitpotam漏洞>防御<strong><strong>PetitPotam漏洞</strong></strong></a></li><li><a href=#总结>总结</a></li><li><a href=#参考>参考</a></li></ol></nav></nav></div><div class=post><hr class=footer-separator><div class=tags></div><div class=back><a href=https://payloads.online/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post></div></div><div class="footer wrapper"><nav class=nav><div>2024 倾旋 All rights reserved</div></nav></div><script>feather.replace()</script><script>var enableTruncate=!0,filterDepth=!1;const MAX_DEPTH=9;window.addEventListener("DOMContentLoaded",()=>{const e=new IntersectionObserver(e=>{e.reverse().forEach(e=>{const n=e.target.getAttribute("id");if(e.intersectionRatio>0){var t=document.querySelectorAll(`nav li a[href="#${n}"]`);t!=null&&t.forEach(e=>{if(e!=null){var t=getDepth(e.parentElement);filterDepth&&t<=MAX_DEPTH&&(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))}else filterDepth||(clearActiveStatesInTableOfContents(),e.parentElement.classList.add("active"))})}})});document.querySelectorAll("h1[id],h2[id],h3[id],h4[id]").forEach(t=>{e.observe(t)})});function isVisible(e){if(!(e instanceof Element))return!1;const n=getComputedStyle(e);if(n.display==="none")return!1;if(n.visibility!=="visible")return!1;if(n.opacity<.1)return!1;if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);do if(s===e)return!0;while(s=s.parentNode)return!1}function clearActiveStatesInTableOfContents(){document.querySelectorAll("nav li").forEach(e=>{e.classList.remove("active")})}function getDepth(e){for(var t=0;e!==null&&e.tagName.toLowerCase()!=="ul";)t++,e=e.parentElement;return t}function navItems(){var e=document.querySelectorAll("nav nav li a");return Array.from(e).filter(e=>e.href!=null&&e.hash.startsWith("#"))}function lasItemInNavBarVisible(){var e=navItems().slice(-1)[0];return isVisible(e)}document.addEventListener("DOMContentLoaded",function(){if(!enableTruncate)return;var e=navItems();console.log(e),lasItemInNavBarVisible()||(filterDepth=!0,e.forEach(function(e){var t=getDepth(e.parentElement);t>MAX_DEPTH&&e.parentElement.classList.add("depth-nested")}))})</script></body></html>