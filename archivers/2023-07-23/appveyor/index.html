<!doctype html><html class="not-ready lg:text-base" style=--bg:#faf8f1 lang=zh-cn dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>使用Appveyor构建VS项目-快速编译 - 倾旋的博客</title><meta name=theme-color><meta name=description content='前言

📋 在工作中经常会看到一些做的比较好的C++开源项目，但是作者没有编写CI/CD去构建项目，发布Release版本的二进制文件，因此需要自己手动编译，但有时候又是临时的环境，还需要安装Visual Studio之类的IDE来构建，比较麻烦，因此appveyor可以支持各类语言的构建环境，只需要在网页上就可以发布二进制程序，解决了本地安装开发环境的痛点。

Appveyor简介

💡 AppVeyor是一家成立于2011年的私人持有的加拿大公司。
我们为Windows开发人员提供持续集成工具。该服务是免费提供给开源项目使用的，我们为私有项目提供订阅服务，并在客户现场提供AppVeyor企业安装服务。
迄今为止，已有超过50,000名开发人员使用了AppVeyor，并运行了超过1000万次构建。AppVeyor受到微软、谷歌、Facebook、Mozilla、Slack、GitHub等公司的信任。
About | AppVeyor

构建Github项目
AppVeyor提供了它特有的配置文件用于声明构建动作，开发者可以通过编写AppVeyor配置文件来控制程序的发布流程。
这里只讨论没有AppVeyor配置文件的项目，以https://github.com/goldshtn/etrace为例，etrace是一个命令行工具，用于实时跟踪 ETW 事件和 处理现有的 .etl 录制文件。它的灵感来自Microsoft ELT工具。

该项目没有AppVeyor配置文件，首先Fork这个项目到自己账户名下，然后访问https://www.appveyor.com/，以Github账户登录，并且授权读取此仓库。

在Github这一栏可以看到授权的仓库，点击 +ADD 就可以进入项目的构建配置界面：

由于这个项目是采用C#开发的，所以我们着重关注C#相关的配置：

在Before build script中输入如下命令，会在开始编译之前去下载这个项目所依赖的库：
nuget restore

💡 "nuget restore" 是NuGet命令行工具中的一个命令。它用于还原（restore）一个项目（project）所依赖的所有NuGet包（NuGet packages）。
在开发.NET应用程序时，通常会使用NuGet来管理项目所依赖的第三方库和组件。NuGet是.NET生态系统中最受欢迎的包管理器之一，它提供了一个中央存储库，开发人员可以从中获取各种软件包和库。
&ldquo;nuget restore"命令会读取项目文件（.csproj或.vbproj）中的依赖关系，并下载或还原所需的NuGet包，以确保项目可以成功编译和构建。这个命令通常在CI/CD（持续集成/持续交付）过程中使用，以确保在构建项目之前，所有的依赖关系都被正确地还原和安装。

除此之外，还可以在环境配置中设置安装开发库的命令：

最后一步就是设置二进制文件打包了，点击artifacts，可以配置要打包的路径，必须是相对路径，C#的程序一般会将二进制文件生成到bin目录下，所以我这里就写：etrace\bin

保存后，回到项目页面，点击Start New Build就开始构建了：

稍微等待一下，就可以看到构建好的程序了，直接下载就可以使用。

使用AppVeyor构建Mimikatz
Mimikatz是gentilkiwi使用C语言开发的Windows安全工具，该工具有着丰富的功能，能过从内存中提取明文密码，哈希，PIN码和kerberos票据、哈希传递等等，随着越来越多的黑客滥用此工具进行一些非法活动，因此gentilkiwi每发布一个Release，Release中的Mimikatz样本就会被标记为黑客工具，这对红队带来了一些小麻烦，通过AppVeyor我们可以自动化的做一些静态特征处理，然后自动构建产生新的工具。
gentilkiwi已经在Mimikatz项目中内置了一个AppVeyor的配置文件，这个配置文件会随着项目改动自动触发AppVeyor的构建流程。

我们要做的就是先Fork一份Mimikatz到自己的项目中，然后开始修改AppVeyor配置文件：

这里我只是做了一个工作，就是将代码中的所有Mimikatz字符串替换为aabbcc，当然还可以做很多其它的替换操作。
ls;
Copy-Item C:\projects\mimikatz\mimikatz\mimikatz.ico C:\projects\mimikatz\mimikatz\aabbcc.ico;
(Get-ChildItem -Path "." -Recurse -File -Include *.h,*.c,*.vcxproj,*.rc) | ForEach-Object {
    $newFileName = $_.Name -replace "mimikatz\.(h|c|rc)", "aabbcc.`$1"
    $newPath = Join-Path -Path $_.Directory.FullName -ChildPath $newFileName
    (Get-Content $_.FullName) | ForEach-Object {
        $_ -ireplace "mimikatz", "aabbcc"
    } | Set-Content $newPath
    if ($newFileName -ne $_.Name) {
        Remove-Item $_.FullName
    }
    Write-Host $newPath
};
ls mimikatz;
其中替换图标的操作可以改为从互联网下载某个地址的图标，这里就不赘述了。'><meta name=author content="倾旋的博客"><link rel="preload stylesheet" as=style href=https://payloads.online/main.min.css><link rel=preload as=image href=https://payloads.online/theme.png><link rel=preload as=image href=/avatar.jpeg><script defer src=https://payloads.online/highlight.min.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://payloads.online/favicon.ico><link rel=apple-touch-icon href=https://payloads.online/apple-touch-icon.png><meta name=generator content="Hugo 0.148.2"><meta itemprop=name content="使用Appveyor构建VS项目-快速编译"><meta itemprop=description content="在工作中经常会看到一些做的比较好的C++开源项目，但是作者没有编写CI/CD去构建项目，发布Release版本的二进制文件，因此需要自己手动编译，但有时候又是临时的环境，还需要安装Visual Studio之类的IDE来构建，比较麻烦，因此appveyor可以支持各类语言的构建环境，只需要在网页上就可以发布二进制程序，解决了本地安装开发环境的痛点。"><meta itemprop=datePublished content="2023-07-23T00:00:00+00:00"><meta itemprop=dateModified content="2023-07-23T00:00:00+00:00"><meta itemprop=wordCount content="113"><meta itemprop=keywords content="Appveyor"><meta property="og:url" content="https://payloads.online/archivers/2023-07-23/appveyor/"><meta property="og:site_name" content="倾旋的博客"><meta property="og:title" content="使用Appveyor构建VS项目-快速编译"><meta property="og:description" content="在工作中经常会看到一些做的比较好的C++开源项目，但是作者没有编写CI/CD去构建项目，发布Release版本的二进制文件，因此需要自己手动编译，但有时候又是临时的环境，还需要安装Visual Studio之类的IDE来构建，比较麻烦，因此appveyor可以支持各类语言的构建环境，只需要在网页上就可以发布二进制程序，解决了本地安装开发环境的痛点。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-23T00:00:00+00:00"><meta property="article:modified_time" content="2023-07-23T00:00:00+00:00"><meta property="article:tag" content="Appveyor"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用Appveyor构建VS项目-快速编译"><meta name=twitter:description content="在工作中经常会看到一些做的比较好的C++开源项目，但是作者没有编写CI/CD去构建项目，发布Release版本的二进制文件，因此需要自己手动编译，但有时候又是临时的环境，还需要安装Visual Studio之类的IDE来构建，比较麻烦，因此appveyor可以支持各类语言的构建环境，只需要在网页上就可以发布二进制程序，解决了本地安装开发环境的痛点。"><link rel=canonical href=https://payloads.online/archivers/2023-07-23/appveyor/></head><body class="bg-(--bg) text-black antialiased duration-200 ease-out [-webkit-tap-highlight-color:transparent] dark:text-white"><header class="mx-auto flex h-[4.5rem] max-w-(--w) px-8 whitespace-nowrap lg:justify-center"><div class="relative z-50 flex items-center ltr:mr-auto rtl:ml-auto"><a class="-translate-y-[1px] text-2xl font-medium" href=https://payloads.online/>倾旋的博客</a><div class="btn-dark text-[0px] ltr:ml-4 rtl:mr-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden ltr:-mr-8 rtl:-ml-8" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg="#faf8f1".replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full flex-col justify-center bg-(--bg) pb-16 duration-200 select-none lg:static lg:h-auto lg:flex-row lg:bg-transparent! lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-10 rtl:space-x-reverse"><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/>首页</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/posts/>文章列表</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/tags>标签</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/projects>开源项目</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/about>关于我</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/links/>友情链接</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/message>留言</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/sponsor>赞助</a></nav></div></header><main class="prose prose-neutral dark:prose-invert relative mx-auto min-h-[calc(100vh-9rem)] max-w-(--w) px-8 pt-14 pb-16"><article><header class=mb-14><h1 class="my-0! pb-2.5">使用Appveyor构建VS项目-快速编译</h1><div class="text-xs antialiased opacity-60"><time>Jul 23, 2023</time><span class=mx-1>&#183;</span>
<span>倾旋</span></div></header><section><h2 id=前言>前言</h2><aside>📋 在工作中经常会看到一些做的比较好的C++开源项目，但是作者没有编写CI/CD去构建项目，发布Release版本的二进制文件，因此需要自己手动编译，但有时候又是临时的环境，还需要安装Visual Studio之类的IDE来构建，比较麻烦，因此appveyor可以支持各类语言的构建环境，只需要在网页上就可以发布二进制程序，解决了本地安装开发环境的痛点。</aside><h2 id=appveyor简介>Appveyor简介</h2><aside>💡 AppVeyor是一家成立于2011年的私人持有的加拿大公司。<p>我们为Windows开发人员提供持续集成工具。该服务是免费提供给开源项目使用的，我们为私有项目提供订阅服务，并在客户现场提供AppVeyor企业安装服务。</p><p>迄今为止，已有超过50,000名开发人员使用了AppVeyor，并运行了超过1000万次构建。AppVeyor受到微软、谷歌、Facebook、Mozilla、Slack、GitHub等公司的信任。</p><p><a href=https://www.appveyor.com/about/>About | AppVeyor</a></p></aside><h2 id=构建github项目>构建Github项目</h2><p>AppVeyor提供了它特有的配置文件用于声明构建动作，开发者可以通过编写AppVeyor配置文件来控制程序的发布流程。</p><p>这里只讨论没有AppVeyor配置文件的项目，以https://github.com/goldshtn/etrace为例，etrace是一个命令行工具，用于实时跟踪 ETW 事件和 处理现有的 .etl 录制文件。它的灵感来自Microsoft <a href=https://github.com/Microsoft/Microsoft.Diagnostics.Tracing.Logging/tree/master/utils/LogTool>ELT</a>工具。</p><p><img src=https://images.payloads.online/2024-07-29-5dc81fb4ac997c5b4bde39e315f39c8f87b29af725c22684aec2530770030f47.png alt=0></p><p>该项目没有AppVeyor配置文件，首先Fork这个项目到自己账户名下，然后访问https://www.appveyor.com/，以Github账户登录，并且授权读取此仓库。</p><p><img src=https://images.payloads.online/2024-07-29-b3783ff0a64525ecfe7a180228595ce723443326cd8b6f720cf98246f0cd7b25.png alt=1></p><p>在Github这一栏可以看到授权的仓库，点击 <strong>+ADD</strong> 就可以进入项目的构建配置界面：</p><p><img src=https://images.payloads.online/2024-07-29-0901705e6c5f3cc7db29338176b4c9558f1e87bf3a5e092df44706d38ae89b61.png alt=2></p><p>由于这个项目是采用C#开发的，所以我们着重关注C#相关的配置：</p><p><img src=https://images.payloads.online/2024-07-29-1b7abdb53043453e086a25620f4411330f445299864c87d91beb53bc87a47890.png alt=3></p><p>在Before build script中输入如下命令，会在开始编译之前去下载这个项目所依赖的库：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nuget restore
</span></span></code></pre></div><aside>💡 "nuget restore" 是NuGet命令行工具中的一个命令。它用于还原（restore）一个项目（project）所依赖的所有NuGet包（NuGet packages）。<p>在开发.NET应用程序时，通常会使用NuGet来管理项目所依赖的第三方库和组件。NuGet是.NET生态系统中最受欢迎的包管理器之一，它提供了一个中央存储库，开发人员可以从中获取各种软件包和库。</p><p>&ldquo;nuget restore"命令会读取项目文件（.csproj或.vbproj）中的依赖关系，并下载或还原所需的NuGet包，以确保项目可以成功编译和构建。这个命令通常在CI/CD（持续集成/持续交付）过程中使用，以确保在构建项目之前，所有的依赖关系都被正确地还原和安装。</p></aside><p>除此之外，还可以在环境配置中设置安装开发库的命令：</p><p><img src=https://images.payloads.online/2024-07-29-d2dbacd81fcf3c3ae4c2d9dad8dbfaafff18b18a138d0b6d46d966c00c66e23c.png alt=4></p><p>最后一步就是设置二进制文件打包了，点击artifacts，可以配置要打包的路径，必须是相对路径，C#的程序一般会将二进制文件生成到bin目录下，所以我这里就写：etrace\bin</p><p><img src=https://images.payloads.online/2024-07-29-250ee79944bc86c985221b13aee115fb153e56ca50d88d16799a3eebb3d29c44.png alt=5></p><p>保存后，回到项目页面，点击Start New Build就开始构建了：</p><p><img src=https://images.payloads.online/2024-07-29-51d2f8ad59c102c96729da44ee8c88a28706eefb90c6a52e00e4ae94c055db8b.png alt=6></p><p>稍微等待一下，就可以看到构建好的程序了，直接下载就可以使用。</p><p><img src=https://images.payloads.online/2024-07-29-71e3d69c746a01016da0b57aa98abcd4de9029ce06eec2f5ef3127062e78cb7d.png alt=7></p><h2 id=使用appveyor构建mimikatz>使用AppVeyor构建Mimikatz</h2><p>Mimikatz是<a href=https://github.com/gentilkiwi>gentilkiwi</a>使用C语言开发的Windows安全工具，该工具有着丰富的功能，能过从内存中提取明文密码，哈希，PIN码和kerberos票据、哈希传递等等，随着越来越多的黑客滥用此工具进行一些非法活动，因此<a href=https://github.com/gentilkiwi>gentilkiwi</a>每发布一个Release，Release中的Mimikatz样本就会被标记为黑客工具，这对红队带来了一些小麻烦，通过AppVeyor我们可以自动化的做一些静态特征处理，然后自动构建产生新的工具。</p><p>gentilkiwi已经在Mimikatz项目中内置了一个AppVeyor的配置文件，这个配置文件会随着项目改动自动触发AppVeyor的构建流程。</p><p><img src=https://images.payloads.online/2024-07-29-0238150c9f7ae7a6d62517d0ec9e5beef84f2e8d1e8ba4110fc3a425d8ceb3c1.png alt=8></p><p>我们要做的就是先Fork一份Mimikatz到自己的项目中，然后开始修改AppVeyor配置文件：</p><p><img src=https://images.payloads.online/2024-07-29-eed2a89c92d68e937b3d5989177a2671ac1b8178540e0fea812447eb0967a88c.png alt=9></p><p>这里我只是做了一个工作，就是将代码中的所有Mimikatz字符串替换为aabbcc，当然还可以做很多其它的替换操作。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>ls;
</span></span><span style=display:flex><span>Copy-Item C:\projects\mimikatz\mimikatz\mimikatz.ico C:\projects\mimikatz\mimikatz\aabbcc.ico;
</span></span><span style=display:flex><span>(Get-ChildItem -Path <span style=color:#e6db74>&#34;.&#34;</span> -Recurse <span style=color:#f92672>-File</span> -Include *.h,*.c,*.vcxproj,*.rc) | ForEach-Object {
</span></span><span style=display:flex><span>    $newFileName = $_.Name <span style=color:#f92672>-replace</span> <span style=color:#e6db74>&#34;mimikatz\.(h|c|rc)&#34;</span>, <span style=color:#e6db74>&#34;aabbcc.</span><span style=color:#ae81ff>`$</span><span style=color:#e6db74>1&#34;</span>
</span></span><span style=display:flex><span>    $newPath = Join-Path -Path $_.Directory.FullName -ChildPath $newFileName
</span></span><span style=display:flex><span>    (Get-Content $_.FullName) | ForEach-Object {
</span></span><span style=display:flex><span>        $_ <span style=color:#f92672>-ireplace</span> <span style=color:#e6db74>&#34;mimikatz&#34;</span>, <span style=color:#e6db74>&#34;aabbcc&#34;</span>
</span></span><span style=display:flex><span>    } | Set-Content $newPath
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($newFileName <span style=color:#f92672>-ne</span> $_.Name) {
</span></span><span style=display:flex><span>        Remove-Item $_.FullName
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    Write-Host $newPath
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>ls mimikatz;
</span></span></code></pre></div><p>其中替换图标的操作可以改为从互联网下载某个地址的图标，这里就不赘述了。</p><p>我的配置文件地址：<a href=https://github.com/Rvn0xsy/mimikatz/blob/master/appveyor.yml>mimikatz/appveyor.yml at master · Rvn0xsy/mimikatz (github.com)</a></p><p>编译好的成品如下：</p><p><img src=https://images.payloads.online/2024-07-29-18c0cd95132052716e08d5844cb251b3db4c09f7487d1523a9e96868b54287de.png alt=10></p><p><img src=https://images.payloads.online/2024-07-29-d9018d95f27c32bf006dc370d0994e10e4d4581b5adc4cff146abc3381b59298.png alt=11></p><h2 id=总结>🥪总结</h2><p>通过在线的CI/CD工具可以省去搭建环境的时间，由于CI/CD是事件触发的，每次改动都可以生成新的样本，相当于可以无限次的使用，若是有一些工具实在是非常敏感、静态特征多，可以像我这样写一个类似的批处理加入到CI/CD中做一些简单的对抗处理，本文仅仅是抛砖引玉，我相信还有更节约时间、更高效的方式。</p></section><footer class="mt-12 flex flex-wrap"><a class="mb-1.5 rounded-lg bg-black/[3%] px-5 py-1 no-underline hover:bg-black/[6%] ltr:mr-1.5 rtl:ml-1.5 dark:bg-white/[8%] dark:hover:bg-white/[12%]" href=https://payloads.online/tags/appveyor>appveyor</a></footer><nav class="mt-24 flex overflow-hidden rounded-xl bg-black/[3%] text-lg leading-[1.2]! *:flex *:w-1/2 *:items-center *:p-5 *:font-medium *:no-underline dark:bg-white/[8%] [&>*:hover]:bg-black/[2%] dark:[&>*:hover]:bg-white/[3%]"><a class="ltr:pr-3 rtl:pl-3" href=https://payloads.online/archivers/2023-08-07/clash-config/><span class="ltr:mr-1.5 rtl:ml-1.5">←</span><span>记录一下配置Clash透明代理</span></a><a class="justify-end pl-3 ltr:ml-auto rtl:mr-auto" href=https://payloads.online/archivers/2023-07-19/useful-software/><span>常用软件记录</span><span class="ltr:ml-1.5 rtl:mr-1.5">→</span></a></nav><div class="giscus mt-24"></div><script src=https://giscus.app/client.js data-repo=Rvn0xsy/rvn0xsy.github.io data-repo-id="MDEwOlJlcG9zaXRvcnk0MDEyMzI3MTY=" data-category=General data-category-id=DIC_kwDOF-pTTM4CRDk_ data-mapping=title data-strict=1 data-reactions-enabled=0 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class="mx-auto flex h-[4.5rem] max-w-(--w) items-center px-8 text-xs tracking-wider uppercase opacity-60"><div class=mr-auto>倾旋 All rights reserved</div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>powered by hugo️️</a>️</footer></body></html>