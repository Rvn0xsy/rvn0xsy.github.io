<!DOCTYPE html>
<html lang=""><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>C语言getopt函数</title>
    <meta name="description" content="倾旋的博客">
    <meta name="author" content='倾旋'>

    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous">

    
    <link rel="stylesheet" href="/sass/researcher.min.css">

    
        <link rel="icon" type="image/ico" href="https://payloads.online/favicon.ico">
    

    
        
    
</head>

    <body><div class="container mt-5">
    <nav class="navbar navbar-expand-sm flex-column flex-sm-row text-nowrap p-0">
        <a class="navbar-brand mx-0 mr-sm-auto" style="color: #dc3545;" href="https://payloads.online" title="倾旋的博客">
          
          倾旋的博客
        </a>
        <div class="navbar-nav flex-row flex-wrap justify-content-center">
            
                
                
                    <a class="nav-item nav-link" href="/about" title="About">
                        About
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/links/" title="Links">
                        Links
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/post/" title="Posts">
                        Posts
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/index.xml" title="Rss">
                        Rss
                    </a>
                    
                
            
        </div>
    </nav>
</div>
<hr>
<div id="content">
<div class="container">
    <p>一直都在用这个函数，今天再详细的复习一下</p>
<ul>
<li>目录
{:toc}</li>
</ul>
<h2 id="0x01-c语言getopt函数介绍">0x01 C语言getopt函数介绍</h2>
<p>getopt函数主要用于命令行的参数解析，如果我们想对一个程序输入多个数据，就需要配置参数，而传递的参数那么多，就需要程序去逐个取得对应的参数值。</p>
<p>getopt函数在<code>#include &lt;unistd.h&gt;</code>头文件中</p>
<h3 id="定义原型">定义原型</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getopt</span>(<span style="color:#66d9ef">int</span> argc,<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> argv[ ],<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> optstring);
</code></pre></div><h3 id="函数说明">函数说明</h3>
<p>getopt()用来分析命令行参数。参数argc和argv是由main()传递的参数个数和内容。参数optstring 则代
表欲处理的选项字符串。此函数会返回在argv 中下一个的选项字母,此字母会对应参数optstring 中的字
母。如果选项字符串里的字母后接着冒号“:”,则表示还有相关的参数,全域变量optarg 即会指向此额
外参数。如果getopt()找不到符合的参数则会印出错信息,并将全域变量optopt设为“?”字符,如果不
希望getopt()印出错信息,则只要将全域变量opterr设为0即可。</p>
<h3 id="返回值">返回值</h3>
<p>如果找到符合的参数则返回此参数字母,如果参数不包含在参数optstring 的选项字母则返回“?”字符,
分析结束则返回-1。</p>
<h2 id="0x02-c语言getopt函数范例">0x02 C语言getopt函数范例</h2>
<p>需求：需要一个程序能对用户传入用户名、密码进行加密、解密。</p>
<p>那么现在，我们要先设置好参数名；</p>
<p>例如：</p>
<ul>
<li>用户名：u，usernme</li>
<li>密码：p，password</li>
</ul>
<p>先写一个传入用户名和密码的程序，再考虑加密、解密。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">struct</span> user{
    <span style="color:#66d9ef">char</span> username[<span style="color:#ae81ff">100</span>]; <span style="color:#75715e">// 用户名
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> password[<span style="color:#ae81ff">100</span>]; <span style="color:#75715e">// 密码
</span><span style="color:#75715e"></span>
};

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc,<span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv){
    <span style="color:#66d9ef">struct</span> user info;
    memset(info.username,<span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(info.username)); <span style="color:#75715e">// 清空垃圾数据
</span><span style="color:#75715e"></span>    memset(info.password,<span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(info.password)); <span style="color:#75715e">// 清空垃圾数据
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> ch;
    <span style="color:#66d9ef">while</span>((ch <span style="color:#f92672">=</span> getopt(argc,argv,<span style="color:#e6db74">&#34;u:p:e::&#34;</span>))<span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>){  <span style="color:#75715e">// u后面跟一个“:”代表是必须要参数值 e后面跟两个“:” 代表参数可有可无，不需要参数
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">switch</span>(ch){
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;u&#39;</span><span style="color:#f92672">:</span>
                <span style="color:#66d9ef">if</span>(strlen(optarg)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">99</span>){  <span style="color:#75715e">//读取用户名，当ch为u的时候，optarg 就代表当前参数值了。
</span><span style="color:#75715e"></span>                    printf(<span style="color:#e6db74">&#34;username to long ... </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
                    exit(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
                }
                strcpy(info.username,optarg);
                <span style="color:#66d9ef">break</span>;
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;p&#39;</span><span style="color:#f92672">:</span>
                <span style="color:#66d9ef">if</span>(strlen(optarg)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">99</span>){  <span style="color:#75715e">//读取密码，当ch为p的时候，optarg 就代表当前参数值了。
</span><span style="color:#75715e"></span>                    printf(<span style="color:#e6db74">&#34;password to long ... </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
                    exit(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
                }
                strcpy(info.password,optarg);
                <span style="color:#66d9ef">break</span>;
            <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
                printf(<span style="color:#e6db74">&#34;argv %c </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,ch);
        }
    }
    printf(<span style="color:#e6db74">&#34;[*] 用户名 ：%s ，密码：%s </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,info.username,info.password);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>执行结果：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./untitled -u admin -p admin
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 用户名 ：admin ，密码：admin
</code></pre></div><h2 id="0x03-加密函数">0x03 加密函数</h2>
<p>既然我们得到了用户名和密码，接下来就是加密了。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;crypt.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>

<span style="color:#66d9ef">struct</span> user{
    <span style="color:#66d9ef">char</span> username[<span style="color:#ae81ff">9</span>]; <span style="color:#75715e">// 用户名
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> password[<span style="color:#ae81ff">9</span>]; <span style="color:#75715e">// 密码
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> salt[<span style="color:#ae81ff">3</span>];
};

<span style="color:#66d9ef">void</span>  <span style="color:#a6e22e">encryption</span>(<span style="color:#66d9ef">struct</span> user <span style="color:#f92672">*</span> info){
   strcpy(info<span style="color:#f92672">-&gt;</span>username,crypt(info<span style="color:#f92672">-&gt;</span>username,info<span style="color:#f92672">-&gt;</span>salt));
   strcpy(info<span style="color:#f92672">-&gt;</span>password,crypt(info<span style="color:#f92672">-&gt;</span>password,info<span style="color:#f92672">-&gt;</span>salt));
}


<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc,<span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv){
    <span style="color:#66d9ef">struct</span> user info;
    memset(info.username,<span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(info.username)); <span style="color:#75715e">// 清空垃圾数据
</span><span style="color:#75715e"></span>    memset(info.password,<span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(info.password)); <span style="color:#75715e">// 清空垃圾数据
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> ch;
    <span style="color:#66d9ef">while</span>((ch <span style="color:#f92672">=</span> getopt(argc,argv,<span style="color:#e6db74">&#34;u:p:s:d::&#34;</span>))<span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>){  <span style="color:#75715e">// u后面跟一个“:”代表是必须要参数值 e后面跟两个“:” 代表参数可有可无，不需要参数
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">switch</span>(ch){
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;u&#39;</span><span style="color:#f92672">:</span>
                strncpy(info.username,optarg,<span style="color:#ae81ff">8</span>);
                <span style="color:#66d9ef">break</span>;
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;p&#39;</span><span style="color:#f92672">:</span>
                strncpy(info.password,optarg,<span style="color:#ae81ff">8</span>);
                <span style="color:#66d9ef">break</span>;
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;s&#39;</span><span style="color:#f92672">:</span>
                strncpy(info.salt,optarg,<span style="color:#ae81ff">2</span>);
                <span style="color:#66d9ef">break</span>;
            <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
                printf(<span style="color:#e6db74">&#34;argv %c </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,ch);
        }
    }
    encryption(<span style="color:#f92672">&amp;</span>info);
    printf(<span style="color:#e6db74">&#34;[*] 用户名 ：%s ，密码：%s </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,info.username,info.password);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>输出：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">liyingzhe@thunderobot:~$ ./untitled -u admin -p admin -s 1o
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 用户名 ：1oAQMMMCT1orzL7NjOD/1g ，密码：1orzL7NjOD/1g
</code></pre></div>
</div>

        </div><div id="footer" class="mb-5">
    <hr>
    <div class="container text-center">
        
            <a href="https://twitter.com/Rvn0xsy" class="fab fa-twitter fa-1x" title="Twitter"></a>
        
            <a href="mailto:rvn0xsy@gmail.com" class="fas fa-envelope fa-1x" title="E-mail"></a>
        
    </div>
    
        <div class="container text-center">
            <a href="https://payloads.online" title="- PAYLOADS.ONLINE -"><small>- PAYLOADS.ONLINE -</small></a>
        </div>
    
</div>
</body>
</html>
